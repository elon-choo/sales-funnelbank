# Magnetic Sales WebApp - PRD v2.0

## 문서 정보

| 항목 | 내용 |
|------|------|
| 버전 | PRD v2.0 |
| 작성일 | 2025-12-15 |
| 기반 문서 | PRD v1.0 + RedTeam 리뷰 + BlueTeam 개선안 |
| 상태 | 개발팀 구현 준비 완료 |
| 품질 점수 | 85/100 (기존 62/100에서 개선) |

---

## 1. 개요

### 1.1 프로젝트 목표

**"AI 기반 마그네틱 세일즈 랜딩페이지 자동 생성 SaaS"**

비개발자도 40개 질문에 답변하면 AI가 전환율 높은 마그네틱 세일즈 랜딩페이지를 자동으로 생성해주는 서비스입니다.

### 1.2 핵심 가치

| 가치 | 설명 |
|------|------|
| 간편함 | 복잡한 기술 지식 없이 질문 답변만으로 완성 |
| 효과성 | 검증된 마그네틱 세일즈 18단계 프레임워크 적용 |
| 경제성 | 전문 카피라이터 대비 90% 이상 비용 절감 |

### 1.3 타겟 사용자

- 1인 창업자 / 프리랜서
- 소규모 비즈니스 운영자
- 마케터 / 세일즈 담당자
- 코칭/컨설팅 서비스 제공자

---

## 2. 기술 스택 (v2.0 통일)

### 2.1 프론트엔드

```yaml
Framework: Next.js 15.0.4 (App Router)
Runtime: React 19.0.0
Language: TypeScript 5.7.2
Styling: Tailwind CSS 3.4.16
State Management: Zustand 5.0.1
Form Validation: Zod 3.23.8
Rich Text Editor: TipTap 2.10.3
Sanitization: DOMPurify 3.2.2
Icons: Lucide React 0.460.0
JWT: jose 5.9.6
```

### 2.2 백엔드

```yaml
BaaS: Supabase
  - PostgreSQL 15 (Database)
  - Supabase Auth (인증)
  - Supabase Storage (파일 저장)
  - Row Level Security (RLS)

API: Next.js API Routes (Route Handlers)
Rate Limiting: PostgreSQL + LRU Cache 폴백
Server Protection: server-only 패키지
```

### 2.3 AI

```yaml
Provider: Anthropic Claude API
Model: claude-sonnet-4-20250514
Token Management: 2-Phase (Reserve -> Confirm) + Advisory Lock
Timeout: 90초
Streaming: Server-Sent Events (SSE)
Defense: 다중 레이어 Prompt Injection 방어
```

### 2.4 인프라

```yaml
Hosting: Vercel
  - Edge Network (CDN)
  - Serverless Functions
  - Preview Deployments
  - Cron Jobs (정리 작업용)

Monitoring:
  - Vercel Analytics
  - Sentry (Error Tracking)

CI/CD: GitHub Actions + Vercel
```

---

## 3. package.json (v2.0 확정)

```json
{
  "name": "magnetic-sales-webapp",
  "version": "2.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit",
    "test": "jest",
    "test:e2e": "playwright test",
    "env:validate": "tsx scripts/validate-env.ts"
  },
  "dependencies": {
    "next": "15.0.4",
    "react": "19.0.0",
    "react-dom": "19.0.0",
    "@supabase/supabase-js": "2.47.0",
    "@supabase/ssr": "0.5.2",
    "zustand": "5.0.1",
    "zod": "3.23.8",
    "@tiptap/react": "2.10.3",
    "@tiptap/starter-kit": "2.10.3",
    "@tiptap/extension-placeholder": "2.10.3",
    "dompurify": "3.2.2",
    "lucide-react": "0.460.0",
    "clsx": "2.1.1",
    "tailwind-merge": "2.6.0",
    "jose": "5.9.6",
    "lru-cache": "11.0.2",
    "server-only": "0.0.1"
  },
  "devDependencies": {
    "typescript": "5.7.2",
    "@types/node": "22.10.2",
    "@types/react": "19.0.1",
    "@types/react-dom": "19.0.1",
    "@types/dompurify": "3.0.5",
    "tailwindcss": "3.4.16",
    "postcss": "8.4.49",
    "autoprefixer": "10.4.20",
    "eslint": "9.16.0",
    "eslint-config-next": "15.0.4",
    "jest": "29.7.0",
    "@testing-library/react": "16.1.0",
    "@testing-library/jest-dom": "6.6.3",
    "playwright": "1.49.1",
    "supabase": "1.226.4",
    "tsx": "4.19.2"
  }
}
```

---

## 4. 폴더 구조 (v2.0 확정)

```
magnetic-sales-webapp/
├── src/
│   ├── app/                          # Next.js 15 App Router
│   │   ├── (auth)/                   # 인증 관련 페이지 (레이아웃 그룹)
│   │   │   ├── login/
│   │   │   │   └── page.tsx
│   │   │   ├── signup/
│   │   │   │   └── page.tsx
│   │   │   ├── pending-approval/
│   │   │   │   └── page.tsx
│   │   │   ├── account-deleted/
│   │   │   │   └── page.tsx
│   │   │   └── layout.tsx
│   │   │
│   │   ├── (dashboard)/              # 대시보드 (인증 필요)
│   │   │   ├── dashboard/
│   │   │   │   └── page.tsx
│   │   │   ├── qa/                   # Q&A 세션
│   │   │   │   └── page.tsx
│   │   │   ├── generate/             # AI 생성
│   │   │   │   └── page.tsx
│   │   │   ├── landing-pages/        # 랜딩페이지 목록
│   │   │   │   ├── page.tsx
│   │   │   │   └── [id]/
│   │   │   │       └── page.tsx
│   │   │   ├── trash/                # 휴지통 (복구)
│   │   │   │   └── page.tsx
│   │   │   └── layout.tsx
│   │   │
│   │   ├── (public)/                 # 공개 페이지
│   │   │   ├── lp/[slug]/            # 발행된 랜딩페이지
│   │   │   │   └── page.tsx
│   │   │   └── layout.tsx
│   │   │
│   │   ├── api/                      # API Routes
│   │   │   ├── auth/
│   │   │   │   ├── signup/route.ts
│   │   │   │   ├── login/route.ts
│   │   │   │   ├── logout/route.ts
│   │   │   │   ├── refresh/route.ts
│   │   │   │   └── me/route.ts
│   │   │   ├── ai/
│   │   │   │   ├── generate/route.ts
│   │   │   │   ├── regenerate/route.ts
│   │   │   │   └── tokens/route.ts
│   │   │   ├── lp/
│   │   │   │   ├── route.ts
│   │   │   │   ├── [id]/route.ts
│   │   │   │   ├── [id]/publish/route.ts
│   │   │   │   └── [id]/restore/route.ts
│   │   │   ├── admin/
│   │   │   │   ├── users/route.ts
│   │   │   │   ├── users/[id]/approve/route.ts
│   │   │   │   └── audit-logs/route.ts
│   │   │   └── cron/
│   │   │       └── cleanup/route.ts
│   │   │
│   │   ├── error.tsx                 # 전역 에러 페이지
│   │   ├── not-found.tsx             # 404 페이지
│   │   ├── layout.tsx                # 루트 레이아웃
│   │   ├── page.tsx                  # 홈 페이지
│   │   └── globals.css               # 전역 스타일
│   │
│   ├── components/                   # React 컴포넌트
│   │   ├── ui/                       # 기본 UI 컴포넌트
│   │   │   ├── Button.tsx
│   │   │   ├── Input.tsx
│   │   │   ├── Card.tsx
│   │   │   ├── Modal.tsx
│   │   │   ├── Toast.tsx
│   │   │   ├── Spinner.tsx
│   │   │   └── index.ts
│   │   │
│   │   ├── auth/                     # 인증 관련
│   │   │   ├── LoginForm.tsx
│   │   │   ├── SignupForm.tsx
│   │   │   └── index.ts
│   │   │
│   │   ├── providers/                # Context Providers
│   │   │   ├── AuthProvider.tsx
│   │   │   ├── ToastProvider.tsx
│   │   │   └── index.ts
│   │   │
│   │   ├── qa/                       # Q&A 시스템
│   │   │   ├── QuestionCard.tsx
│   │   │   ├── AnswerInput.tsx
│   │   │   ├── ProgressBar.tsx
│   │   │   ├── QASession.tsx
│   │   │   └── index.ts
│   │   │
│   │   ├── editor/                   # 랜딩페이지 에디터
│   │   │   ├── LPEditor.tsx
│   │   │   ├── SectionEditor.tsx
│   │   │   ├── ImageUploader.tsx
│   │   │   ├── PreviewPane.tsx
│   │   │   └── index.ts
│   │   │
│   │   └── dashboard/                # 대시보드
│   │       ├── Sidebar.tsx
│   │       ├── Header.tsx
│   │       ├── LPList.tsx
│   │       ├── TokenUsage.tsx
│   │       ├── DeletedItems.tsx
│   │       └── index.ts
│   │
│   ├── lib/                          # 유틸리티 및 설정
│   │   ├── supabase/
│   │   │   ├── client.ts             # 클라이언트용 Supabase
│   │   │   ├── server.ts             # 서버용 Supabase (async cookies)
│   │   │   ├── admin.ts              # Admin Supabase (server-only)
│   │   │   └── config.ts             # Supabase/Cookie 설정
│   │   │
│   │   ├── auth/
│   │   │   ├── tokens.ts             # JWT 생성/검증 (jose)
│   │   │   ├── guards.ts             # withAuth, withAdminAuth HOF
│   │   │   └── rotation.ts           # Refresh Token Rotation
│   │   │
│   │   ├── ai/
│   │   │   ├── claude.ts             # Claude API 클라이언트
│   │   │   ├── prompts.ts            # 프롬프트 템플릿
│   │   │   ├── generator.ts          # 랜딩페이지 생성 로직
│   │   │   └── token-manager.ts      # 토큰 예약/확정
│   │   │
│   │   ├── security/
│   │   │   ├── prompt-injection.ts   # Prompt Injection 방어 (v2)
│   │   │   ├── output-validator.ts   # AI 출력 검증
│   │   │   ├── cors.ts               # CORS 미들웨어
│   │   │   ├── rate-limit.ts         # Rate Limiting (Fail-Closed)
│   │   │   ├── crypto.ts             # 해시, 토큰 생성
│   │   │   └── sanitize.ts           # DOMPurify 설정
│   │   │
│   │   ├── config/
│   │   │   ├── env.ts                # 환경변수 검증
│   │   │   └── constants.ts          # 상수 정의
│   │   │
│   │   └── utils/
│   │       ├── errors.ts             # 에러 코드 정의
│   │       ├── api-response.ts       # 표준 API 응답
│   │       ├── validators.ts         # Zod 스키마
│   │       └── helpers.ts            # 헬퍼 함수
│   │
│   ├── hooks/                        # Custom Hooks
│   │   ├── useAuth.ts
│   │   ├── useQASession.ts
│   │   ├── useTokens.ts
│   │   ├── useLandingPage.ts
│   │   └── index.ts
│   │
│   ├── stores/                       # Zustand Stores
│   │   ├── authStore.ts
│   │   ├── qaStore.ts
│   │   ├── editorStore.ts
│   │   └── index.ts
│   │
│   └── types/                        # TypeScript 타입
│       ├── auth.ts
│       ├── database.ts
│       ├── api.ts
│       ├── ai.ts
│       └── index.ts
│
├── supabase/                         # Supabase 설정
│   ├── migrations/                   # DB 마이그레이션 (순서대로 실행)
│   │   ├── 001_initial_schema.sql
│   │   ├── 002_soft_delete.sql
│   │   ├── 003_refresh_tokens.sql
│   │   ├── 004_audit_logs.sql
│   │   ├── 005_rate_limits.sql
│   │   ├── 006_token_reservations.sql
│   │   ├── 007_functions_triggers.sql
│   │   ├── 008_rls_policies.sql
│   │   └── 009_schema_fixes.sql
│   │
│   └── config.toml                   # Supabase CLI 설정
│
├── scripts/                          # 유틸리티 스크립트
│   └── validate-env.ts               # 환경변수 검증 스크립트
│
├── public/                           # 정적 파일
│   ├── images/
│   └── favicon.ico
│
├── tests/                            # 테스트
│   ├── unit/
│   │   ├── auth/
│   │   ├── security/
│   │   └── utils/
│   ├── integration/
│   │   ├── api/
│   │   └── auth/
│   └── e2e/
│       ├── auth.spec.ts
│       └── landing-page.spec.ts
│
├── .env.local                        # 로컬 환경 변수 (gitignore)
├── .env.example                      # 환경 변수 예시
├── next.config.ts                    # Next.js 설정 (TypeScript)
├── tailwind.config.ts                # Tailwind 설정
├── tsconfig.json                     # TypeScript 설정
├── vercel.json                       # Vercel 설정 (Cron Jobs)
├── package.json
└── README.md
```

---

## 5. 환경 변수 (v2.0 확정)

### 5.1 환경 변수 파일 (.env.example)

```bash
# ===========================================
# Supabase (필수)
# ===========================================
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# CRITICAL: JWT Secret (Supabase Dashboard > Settings > API > JWT Secret)
# 절대 NEXT_PUBLIC_ 접두사 사용 금지!
SUPABASE_JWT_SECRET=your-jwt-secret-from-supabase-dashboard

# ===========================================
# Database Connection (마이그레이션용)
# ===========================================
SUPABASE_DB_HOST=db.your-project.supabase.co
SUPABASE_DB_PORT=5432
SUPABASE_DB_USER=postgres
SUPABASE_DB_PASSWORD=your-password
SUPABASE_DB_NAME=postgres

# ===========================================
# Claude API (필수)
# ===========================================
ANTHROPIC_API_KEY=sk-ant-api03-...

# ===========================================
# Cookie Settings
# ===========================================
# Production에서만 설정 (localhost에서는 비워둠)
COOKIE_DOMAIN=.magnetic-sales.com

# ===========================================
# CORS (쉼표로 구분)
# ===========================================
ADDITIONAL_CORS_ORIGINS=https://staging.magnetic-sales.vercel.app

# ===========================================
# Application URLs (필수)
# ===========================================
NEXT_PUBLIC_APP_URL=https://magnetic-sales.vercel.app
NEXT_PUBLIC_LP_DOMAIN=https://lp.magnetic-sales.com

# ===========================================
# Security Alerts (선택)
# ===========================================
SECURITY_ALERT_WEBHOOK_URL=https://hooks.slack.com/services/xxx/yyy/zzz

# ===========================================
# Monitoring (선택)
# ===========================================
SENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx
NEXT_PUBLIC_SENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx

# ===========================================
# Cron Job Secret (Vercel Cron 인증용)
# ===========================================
CRON_SECRET=your-random-secret-for-cron-jobs
```

### 5.2 환경별 설정

| 환경 | NODE_ENV | 특징 |
|------|----------|------|
| Development | development | localhost:3000, 디버그 로그, secure=false |
| Preview | production | Vercel Preview, 테스트 DB |
| Production | production | 프로덕션 DB, secure=true, 에러 모니터링 |

### 5.3 환경변수 검증 (앱 시작 시 자동 실행)

```typescript
// scripts/validate-env.ts
const requiredVars = [
  'NEXT_PUBLIC_SUPABASE_URL',
  'NEXT_PUBLIC_SUPABASE_ANON_KEY',
  'SUPABASE_SERVICE_ROLE_KEY',
  'SUPABASE_JWT_SECRET',
  'ANTHROPIC_API_KEY',
];

// SUPABASE_JWT_SECRET 길이 검증 (최소 32자)
// NEXT_PUBLIC_ 접두사로 시작하는 Service Role Key 경고
```

---

## 6. 핵심 기능 요약

### 6.1 사용자 등급

| 등급 | 일일 토큰 | 랜딩페이지 수 | 가격 |
|------|----------|--------------|------|
| FREE | 100,000 | 3개 | 무료 |
| PRO | 500,000 | 무제한 | $29/월 |
| ENTERPRISE | 2,000,000 | 무제한 | $99/월 |

### 6.2 주요 보안 기능 (v2.0)

| 기능 | 구현 방식 |
|------|----------|
| CORS | 명시적 화이트리스트 (와일드카드 금지) |
| JWT 저장 | HttpOnly Cookie + Refresh Token Rotation |
| 토큰 관리 | 2-Phase (Reserve -> Confirm) + hashtext() Advisory Lock |
| 삭제 | Soft Delete (30일 복구 기간) |
| Rate Limiting | PostgreSQL + LRU Cache 폴백 (Fail-Closed) |
| XSS 방지 | DOMPurify + CSP 헤더 (nonce 기반) |
| Prompt Injection | 다중 레이어 방어 (정규화 + 패턴 + 키워드) |
| 서버 보호 | server-only 패키지로 Service Role Key 보호 |
| Timing Attack | crypto.timingSafeEqual() 사용 |

### 6.3 인증 플로우

```
1. 회원가입 -> is_approved: false (관리자 승인 대기)
2. 관리자 승인 -> is_approved: true
3. 로그인 -> Access Token (15분, 메모리) + Refresh Token (7일, HttpOnly Cookie)
4. API 호출 -> Bearer Token 검증 + 프로필 조회 (승인/삭제 상태 확인)
5. 토큰 만료 전 -> 자동 갱신 (14분 주기)
6. Refresh Token 사용 -> 즉시 폐기 + 새 토큰 발급 (Rotation)
7. Token 재사용 감지 -> 모든 세션 즉시 종료 + 보안 알림
```

---

## 7. 관련 PRD 문서

| 문서 | 파일명 | 내용 |
|------|--------|------|
| 인증 시스템 | 01_인증_시스템_v2.md | Token Rotation, JWT, 모든 API 구현 |
| 데이터베이스 | 02_데이터베이스_v2.md | 테이블 스키마, RLS 통합, 마이그레이션 |
| API 엔드포인트 | 03_API_엔드포인트_v2.md | REST API, CORS, Rate Limiting (Fail-Closed) |
| AI 통합 | 04_AI_통합_v2.md | Prompt Injection 다중 방어, 토큰 관리, SSE |
| 프론트엔드 | 05_프론트엔드_v2.md | Next.js 15 호환 코드, AuthProvider 개선 |
| 보안 체크리스트 | 06_보안_체크리스트_v2.md | OWASP Top 10 100% 대응, 감사 로그 |
| 구현 로드맵 | 07_구현_로드맵.md | Phase별 구현 계획, 체크리스트 |

---

## 8. 구현 일정 (10일)

### Phase 0: 긴급 수정 (Day 1)

- [x] Next.js 15.0.4 버전 통일
- [x] package.json 업데이트
- [x] server-only 패키지 추가
- [x] Rate Limit fail-closed 변경
- [x] 환경변수 검증 추가

### Phase 1: 인증 시스템 완성 (Day 2-4)

- [ ] JWT Secret 설정 (Supabase Dashboard)
- [ ] Token Rotation 구현 (jose 라이브러리)
- [ ] 회원가입 API (/api/auth/signup)
- [ ] 로그인 API (/api/auth/login)
- [ ] 로그아웃 API (/api/auth/logout)
- [ ] 토큰 갱신 API (/api/auth/refresh)
- [ ] 내 정보 API (/api/auth/me)
- [ ] withAuth HOF 통일
- [ ] AuthProvider 무한루프 수정

### Phase 2: 데이터베이스 수정 (Day 5-6)

- [ ] RLS 정책 통합 (OR -> 단일 정책)
- [ ] token_usage 스키마 수정 (reservation_id 추가)
- [ ] approval_changed_at 컬럼 추가
- [ ] Advisory Lock hashtext() 수정
- [ ] 인덱스 최적화
- [ ] 마이그레이션 테스트

### Phase 3: AI 보안 강화 (Day 7-8)

- [ ] Prompt Injection 정규화 (유니코드, 공백)
- [ ] 다중 레이어 방어 (패턴 + 키워드 조합)
- [ ] 토큰 추정 로직 개선 (한글 ~1.5자당 1토큰)
- [ ] SSE 타임아웃 추가 (AbortController)
- [ ] 출력 검증 강화

### Phase 4: 일반 보안 및 마무리 (Day 9-10)

- [ ] CSP nonce 기반 적용
- [ ] Timing-safe 비교 구현
- [ ] 환경변수 정리
- [ ] IP 추출 보안 강화 (x-vercel-forwarded-for)
- [ ] 보안 테스트
- [ ] 문서 정리

---

## 9. 개발 시작하기

### 9.1 프로젝트 클론 및 설정

```bash
# 1. 프로젝트 클론
git clone https://github.com/your-org/magnetic-sales-webapp.git
cd magnetic-sales-webapp

# 2. 의존성 설치
npm install

# 3. 환경 변수 설정
cp .env.example .env.local
# .env.local 파일을 편집하여 실제 값 입력

# 4. 환경변수 검증 실행
npm run env:validate

# 5. Supabase 마이그레이션 실행
npx supabase db push

# 6. 개발 서버 시작
npm run dev
```

### 9.2 Supabase JWT Secret 확인 방법

```
1. Supabase Dashboard 접속
2. Project Settings > API 클릭
3. "JWT Settings" 섹션에서 "JWT Secret" 값 복사
4. .env.local에 SUPABASE_JWT_SECRET=복사한값 설정
```

### 9.3 유용한 명령어

```bash
# 개발 서버
npm run dev

# 타입 체크
npm run type-check

# 린트
npm run lint

# 테스트
npm run test

# E2E 테스트
npm run test:e2e

# 빌드
npm run build

# 환경변수 검증
npm run env:validate

# Supabase 로컬 시작
npx supabase start

# 마이그레이션 생성
npx supabase migration new <migration_name>

# 마이그레이션 적용
npx supabase db push

# 타입 생성 (Supabase 스키마 기반)
npx supabase gen types typescript --local > src/types/database.ts
```

---

## 10. Next.js 설정 (v2.0)

### 10.1 next.config.ts

```typescript
import type { NextConfig } from 'next';

const nextConfig: NextConfig = {
  // 보안 헤더
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'X-DNS-Prefetch-Control',
            value: 'on',
          },
          {
            key: 'Strict-Transport-Security',
            value: 'max-age=63072000; includeSubDomains; preload',
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          {
            key: 'X-XSS-Protection',
            value: '1; mode=block',
          },
          {
            key: 'Referrer-Policy',
            value: 'strict-origin-when-cross-origin',
          },
          {
            key: 'Permissions-Policy',
            value: 'camera=(), microphone=(), geolocation=()',
          },
        ],
      },
    ];
  },

  // 이미지 도메인 (Supabase Storage)
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '*.supabase.co',
        pathname: '/storage/v1/object/public/**',
      },
    ],
  },

  // 실험적 기능
  experimental: {
    // Next.js 15에서는 serverActions가 기본 활성화
  },

  // 빌드 최적화
  poweredByHeader: false,
};

export default nextConfig;
```

### 10.2 vercel.json (Cron Jobs)

```json
{
  "crons": [
    {
      "path": "/api/cron/cleanup",
      "schedule": "0 * * * *"
    }
  ]
}
```

---

## 11. RedTeam 지적사항 해결 현황

| ID | 문제 | 심각도 | 해결 상태 |
|----|------|--------|-----------|
| CRITICAL-001 | Next.js 버전 불일치 | CRITICAL | v2.0에서 해결 |
| CRITICAL-002 | RLS 정책 충돌 | CRITICAL | 02_데이터베이스_v2.md |
| CRITICAL-003 | Rate Limit Fail-Open | CRITICAL | 03_API_엔드포인트_v2.md |
| CRITICAL-004 | Refresh Token 미완성 | CRITICAL | 01_인증_시스템_v2.md |
| CRITICAL-005 | JWT Secret 문제 | CRITICAL | 환경변수 추가 |
| CRITICAL-006 | Prompt Injection 우회 | CRITICAL | 04_AI_통합_v2.md |
| CRITICAL-007 | Service Role Key 노출 | CRITICAL | server-only 적용 |
| HIGH-001 | 싱글톤 Race Condition | HIGH | 01_인증_시스템_v2.md |
| HIGH-002 | Advisory Lock 충돌 | HIGH | 02_데이터베이스_v2.md |
| HIGH-003 | withAuth 시그니처 불일치 | HIGH | 03_API_엔드포인트_v2.md |
| HIGH-005 | AuthProvider 무한루프 | HIGH | 05_프론트엔드_v2.md |
| HIGH-009 | CSP unsafe-inline | HIGH | 06_보안_체크리스트_v2.md |

---

## 12. 품질 기준

### 12.1 코드 품질

- 모든 코드는 **Copy-Paste 즉시 실행 가능**
- TypeScript strict 모드 적용
- ESLint 경고 0건
- 테스트 커버리지 80% 이상

### 12.2 보안 기준

- OWASP Top 10 100% 대응
- 모든 환경변수 검증
- Service Role Key 서버 전용 보장
- Rate Limiting Fail-Closed 정책

### 12.3 문서 기준

- 버전 불일치 0건
- 경로 불일치 0건
- 타입 불일치 0건
- 누락된 API 0건

---

**다음 문서**: [01_인증_시스템_v2.md](./01_인증_시스템_v2.md)
