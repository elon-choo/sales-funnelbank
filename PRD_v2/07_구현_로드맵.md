# 07. 구현 로드맵

## 개요

Magnetic Sales WebApp의 구현 로드맵은 4개 Phase로 구성되며, 각 Phase는 독립적으로 배포 가능한 기능 단위로 나뉩니다. Red/Blue Team 피드백을 반영하여 보안과 안정성을 최우선으로 합니다.

**총 기간:** 12주 (3개월)
**팀 구성:** 프론트엔드 2명, 백엔드 2명, DevOps 1명

---

## Phase 1: 핵심 인프라 및 인증 (3주)

### 목표
- Next.js 15.0.4 + Supabase 기반 프로젝트 초기화
- 보안이 강화된 인증 시스템 구현
- 데이터베이스 스키마 및 RLS 정책 설정

### 1.1 Week 1: 프로젝트 초기화

#### Day 1-2: Next.js 프로젝트 설정
```bash
# 프로젝트 생성
npx create-next-app@15.0.4 magnetic-sales-webapp --typescript --tailwind --app

# 의존성 설치
npm install @supabase/ssr @supabase/supabase-js jose zod
npm install -D eslint-config-next@15.0.4

# 버전 확인 (CRITICAL-001 대응)
npm list next react react-dom
# next@15.0.4, react@19.0.0, react-dom@19.0.0
```

**Deliverable:**
- [ ] Next.js 15.0.4 + React 19.0.0 프로젝트
- [ ] Tailwind CSS 설정
- [ ] ESLint + TypeScript 설정
- [ ] .gitignore (.env 포함)

#### Day 3-5: Supabase 초기화

```bash
# Supabase 프로젝트 생성 (Dashboard)
# https://supabase.com/dashboard

# 환경 변수 설정
cat > .env.local << EOF
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
SUPABASE_JWT_SECRET=your-jwt-secret-min-32-chars
EOF
```

**Deliverable:**
- [ ] Supabase 프로젝트 생성
- [ ] 환경 변수 설정 (.env.local)
- [ ] Supabase 클라이언트 유틸리티 (server.ts, client.ts)
- [ ] server-only 패키지 적용 (CRITICAL-007)

### 1.2 Week 2: 인증 시스템

#### Day 1-3: 데이터베이스 마이그레이션

```sql
-- 001_users.sql
CREATE TABLE users (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  email TEXT NOT NULL UNIQUE,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- 002_landing_pages.sql
CREATE TABLE landing_pages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id),
  title TEXT NOT NULL,
  sections JSONB NOT NULL,
  is_deleted BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- 003_ai_tokens.sql
CREATE TABLE ai_tokens (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id),
  purchased_tokens INTEGER DEFAULT 0,
  used_tokens INTEGER DEFAULT 0,
  is_deleted BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- ... (총 9개 마이그레이션 파일)
```

**Deliverable:**
- [ ] 9개 마이그레이션 파일 작성
- [ ] Supabase에 마이그레이션 적용
- [ ] RLS 정책 설정 (CRITICAL-002)

#### Day 4-5: 인증 API 구현

```typescript
// src/app/api/auth/signup/route.ts
// src/app/api/auth/login/route.ts
// src/app/api/auth/refresh/route.ts
// src/app/api/auth/logout/route.ts
// src/app/api/auth/me/route.ts
```

**Deliverable:**
- [ ] 회원가입 API (비밀번호 검증)
- [ ] 로그인 API (Rate Limiting)
- [ ] Token Rotation 구현 (CRITICAL-005)
- [ ] withAuth HOF 패턴 (HIGH-001)
- [ ] Postman/Insomnia 테스트 컬렉션

### 1.3 Week 3: 인증 UI 및 테스트

#### Day 1-3: 프론트엔드 UI

```typescript
// src/components/auth/LoginForm.tsx
// src/components/auth/SignupForm.tsx
// src/components/ui/Button.tsx
// src/components/ui/Input.tsx
```

**Deliverable:**
- [ ] 로그인/회원가입 폼 컴포넌트
- [ ] Server Actions 사용 (Progressive Enhancement)
- [ ] Zod 스키마 검증 (HIGH-013)
- [ ] Tailwind CSS 스타일링

#### Day 4-5: 테스트 및 배포

```typescript
// __tests__/auth/login.test.ts
// __tests__/auth/tokenRotation.test.ts
// e2e/auth.spec.ts (Playwright)
```

**Deliverable:**
- [ ] 단위 테스트 (Jest + React Testing Library)
- [ ] E2E 테스트 (Playwright)
- [ ] Vercel에 Phase 1 배포
- [ ] CI/CD 파이프라인 설정

---

## Phase 2: 랜딩페이지 시스템 (3주)

### 목표
- 랜딩페이지 생성/편집 기능 구현
- WYSIWYG 에디터 통합
- 공개 URL 생성 및 SSG 최적화

### 2.1 Week 4: 랜딩페이지 API

#### Day 1-3: API 엔드포인트

```typescript
// src/app/api/lp/create/route.ts
// src/app/api/lp/[id]/route.ts (GET, PUT, DELETE)
// src/app/api/lp/list/route.ts
```

**Deliverable:**
- [ ] 랜딩페이지 생성 API
- [ ] 랜딩페이지 조회/수정/삭제 API
- [ ] Soft Delete 구현 (HIGH-014)
- [ ] Rate Limiting 적용 (분당 10회)

#### Day 4-5: 데이터베이스 최적화

```sql
-- 인덱스 추가
CREATE INDEX idx_landing_pages_user ON landing_pages(user_id)
  WHERE is_deleted = false;

-- 전문 검색 (Full-Text Search)
CREATE INDEX idx_landing_pages_title ON landing_pages
  USING gin(to_tsvector('english', title));
```

**Deliverable:**
- [ ] 성능 최적화 인덱스
- [ ] 전문 검색 기능
- [ ] 랜딩페이지 개수 제한 (사용자당 100개)

### 2.2 Week 5: 에디터 UI

#### Day 1-3: 에디터 컴포넌트

```typescript
// src/components/lp/LandingPageEditor.tsx
// src/components/lp/SectionEditor.tsx
// src/components/lp/StylePanel.tsx
```

**Deliverable:**
- [ ] 드래그 앤 드롭 에디터
- [ ] 4가지 섹션 타입 (Hero, Features, Pricing, CTA)
- [ ] 실시간 프리뷰
- [ ] 자동 저장 (3초마다)

#### Day 4-5: 템플릿 시스템

```typescript
// src/lib/lp/templates.ts
export const TEMPLATES = [
  {
    id: 'saas-startup',
    name: 'SaaS Startup',
    sections: [/* ... */],
  },
  {
    id: 'product-launch',
    name: 'Product Launch',
    sections: [/* ... */],
  },
  // 10개 템플릿
];
```

**Deliverable:**
- [ ] 10개 사전 제작 템플릿
- [ ] 템플릿 미리보기
- [ ] 템플릿 적용 API

### 2.3 Week 6: 공개 URL 및 최적화

#### Day 1-2: 공개 URL 생성

```typescript
// src/app/lp/[id]/page.tsx
export async function generateStaticParams() {
  const supabase = createClient();
  const { data } = await supabase.from('landing_pages').select('id');
  return data?.map(lp => ({ id: lp.id })) || [];
}

export async function generateMetadata({ params }): Promise<Metadata> {
  // 동적 메타데이터 생성
}
```

**Deliverable:**
- [ ] 공개 URL (/lp/[id])
- [ ] SSG (Static Site Generation)
- [ ] 동적 메타데이터 (SEO)
- [ ] OG 이미지 자동 생성

#### Day 3-5: 성능 최적화 및 테스트

```bash
# Lighthouse 점수 목표
Performance: 95+
Accessibility: 100
Best Practices: 100
SEO: 100
```

**Deliverable:**
- [ ] 이미지 최적화 (Next.js Image)
- [ ] 코드 스플리팅
- [ ] Lighthouse 점수 95+
- [ ] E2E 테스트 (에디터 사용 시나리오)

---

## Phase 3: AI 통합 (3주)

### 목표
- Claude API 통합
- Prompt Injection 방어 시스템
- 토큰 관리 및 SSE 스트리밍

### 3.1 Week 7: AI 기반 구조

#### Day 1-2: Claude API 연동

```typescript
// src/lib/ai/claude.ts
import Anthropic from '@anthropic-ai/sdk';

const client = new Anthropic({
  apiKey: process.env.ANTHROPIC_API_KEY!,
});

export async function callClaude(messages: Message[]) {
  return await client.messages.create({
    model: 'claude-3-5-sonnet-20241022',
    max_tokens: 4096,
    stream: true,
    messages,
  });
}
```

**Deliverable:**
- [ ] Claude SDK 설치 및 설정
- [ ] API 키 환경 변수화
- [ ] 간단한 채팅 API 구현

#### Day 3-5: Prompt Injection 방어

```typescript
// src/lib/ai/promptDefense.ts
// Layer 1: Unicode Normalization
// Layer 2: Pattern Matching
// Layer 3: Keyword Combinations
// Layer 4: System Prompt 보호
```

**Deliverable:**
- [ ] 4층 방어 시스템 구현 (CRITICAL-006)
- [ ] Unicode Normalization (MEDIUM-016)
- [ ] 정규식 패턴 매칭 (MEDIUM-017)
- [ ] 키워드 조합 탐지 (MEDIUM-018)
- [ ] 테스트 케이스 (20개 공격 시나리오)

### 3.2 Week 8: 토큰 관리

#### Day 1-3: 토큰 예약/확정 시스템

```typescript
// src/lib/ai/tokenManager.ts
export async function reserveTokens(userId: string, amount: number)
export async function confirmTokenUsage(userId: string, actualUsage: number)
```

**Deliverable:**
- [ ] Advisory Lock 구현 (HIGH-006)
- [ ] 보수적 예약 전략 (50% 버퍼)
- [ ] 실제 사용량 기반 확정
- [ ] 초과 예약분 환불

#### Day 4-5: 사용량 로깅

```sql
-- ai_usage_logs 테이블
CREATE TABLE ai_usage_logs (
  id UUID PRIMARY KEY,
  user_id UUID NOT NULL,
  prompt_tokens INTEGER,
  completion_tokens INTEGER,
  total_cost DECIMAL(10, 6),
  created_at TIMESTAMPTZ DEFAULT now()
);
```

**Deliverable:**
- [ ] 사용 내역 저장
- [ ] 비용 계산
- [ ] 월별 리포트 생성

### 3.3 Week 9: AI 채팅 UI

#### Day 1-3: SSE 스트리밍

```typescript
// src/app/api/ai/chat/route.ts
export const runtime = 'edge';
export const maxDuration = 90; // MEDIUM-015

export async function POST(request: NextRequest) {
  // SSE 스트림 생성
}
```

**Deliverable:**
- [ ] SSE 엔드포인트 구현
- [ ] 90초 타임아웃 (MEDIUM-015)
- [ ] 클라이언트 EventSource 연결
- [ ] 실시간 토큰 잔액 업데이트

#### Day 4-5: AI 채팅 UI

```typescript
// src/components/ai/AiChat.tsx
// src/components/ai/TokenBalance.tsx
```

**Deliverable:**
- [ ] 채팅 인터페이스
- [ ] 스트리밍 텍스트 렌더링
- [ ] 토큰 잔액 표시
- [ ] 대화 기록 저장

---

## Phase 4: Admin 및 프로덕션 준비 (3주)

### 목표
- Admin 대시보드 구현
- 보안 모니터링 시스템
- 프로덕션 배포 및 최적화

### 4.1 Week 10: Admin 대시보드

#### Day 1-2: Admin 권한 관리

```sql
-- admins 테이블
CREATE TABLE admins (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id),
  role TEXT NOT NULL CHECK (role IN ('admin', 'super_admin')),
  is_deleted BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT now()
);
```

**Deliverable:**
- [ ] Admin 테이블 생성
- [ ] Admin 권한 검증 함수 (MEDIUM-001)
- [ ] Admin 전용 레이아웃

#### Day 3-5: 사용자 관리

```typescript
// src/app/admin/users/page.tsx
// 사용자 목록, 검색, 필터링, 정지/복구
```

**Deliverable:**
- [ ] 사용자 목록 페이지
- [ ] 사용자 상세 정보
- [ ] 계정 정지/복구 기능
- [ ] 사용자 통계 대시보드

### 4.2 Week 11: 모니터링 및 알림

#### Day 1-3: 보안 로깅

```typescript
// src/lib/logging/securityLogger.ts
export async function logSecurityEvent(event: SecurityEvent)
```

**Deliverable:**
- [ ] 보안 이벤트 로깅 (MEDIUM-010)
- [ ] security_logs 테이블
- [ ] 이상 탐지 알림 (MEDIUM-011)
- [ ] 실시간 모니터링 대시보드

#### Day 4-5: AI 사용량 대시보드

```typescript
// src/app/admin/ai-usage/page.tsx
```

**Deliverable:**
- [ ] AI 사용 통계
- [ ] 비용 분석
- [ ] 사용자별 사용량
- [ ] 월별/일별 리포트

### 4.3 Week 12: 프로덕션 배포

#### Day 1-2: 최종 보안 점검

```bash
# 보안 체크리스트 70개 항목 검증
- CRITICAL (12개)
- HIGH (18개)
- MEDIUM (25개)
- LOW (15개)
```

**Deliverable:**
- [ ] 보안 체크리스트 70개 항목 완료
- [ ] npm audit 취약점 0개
- [ ] OWASP ZAP 스캔 통과
- [ ] 침투 테스트 완료

#### Day 3-4: 성능 최적화

```bash
# 성능 목표
- Lighthouse Performance: 95+
- TTFB (Time to First Byte): < 200ms
- FCP (First Contentful Paint): < 1s
- LCP (Largest Contentful Paint): < 2.5s
```

**Deliverable:**
- [ ] 코드 스플리팅 최적화
- [ ] 이미지 최적화 (WebP, AVIF)
- [ ] CDN 설정
- [ ] 데이터베이스 쿼리 최적화

#### Day 5: 프로덕션 배포

```bash
# Vercel 배포
vercel --prod

# 배포 후 검증
- 모든 API 엔드포인트 동작 확인
- SSL 인증서 확인
- CORS 정책 검증
- Rate Limiting 동작 확인
```

**Deliverable:**
- [ ] Vercel Production 배포
- [ ] 커스텀 도메인 설정
- [ ] SSL 인증서 적용
- [ ] 배포 후 스모크 테스트

---

## 마일스톤 및 주요 산출물

### Milestone 1: 인증 시스템 (Week 3 종료)
- [x] Next.js 15.0.4 + React 19.0.0 프로젝트
- [x] Supabase 데이터베이스 9개 마이그레이션
- [x] 5개 인증 API (signup, login, refresh, logout, me)
- [x] Token Rotation 구현
- [x] withAuth HOF 패턴
- [x] 로그인/회원가입 UI

### Milestone 2: 랜딩페이지 시스템 (Week 6 종료)
- [x] 랜딩페이지 CRUD API
- [x] WYSIWYG 에디터
- [x] 10개 템플릿
- [x] 공개 URL (SSG)
- [x] SEO 최적화

### Milestone 3: AI 통합 (Week 9 종료)
- [x] Claude API 연동
- [x] Prompt Injection 4층 방어
- [x] 토큰 예약/확정 시스템
- [x] SSE 스트리밍
- [x] AI 채팅 UI

### Milestone 4: 프로덕션 준비 (Week 12 종료)
- [x] Admin 대시보드
- [x] 보안 모니터링
- [x] 70개 보안 체크리스트 완료
- [x] Vercel Production 배포

---

## 리스크 관리

### 기술적 리스크

| 리스크 | 영향도 | 확률 | 완화 전략 |
|--------|--------|------|----------|
| **Next.js 15 호환성 문제** | 높음 | 중간 | 공식 문서 참조, 커뮤니티 활용 |
| **Claude API Rate Limit** | 중간 | 낮음 | Tier 2 요금제, 캐싱 전략 |
| **Supabase RLS 성능** | 중간 | 중간 | 인덱스 최적화, 쿼리 개선 |
| **SSE 스트리밍 안정성** | 낮음 | 낮음 | 90초 타임아웃, 재연결 로직 |

### 일정 리스크

| 리스크 | 영향도 | 확률 | 완화 전략 |
|--------|--------|------|----------|
| **AI 통합 지연** | 높음 | 중간 | Phase 3를 2주 연장 가능 |
| **보안 취약점 발견** | 높음 | 낮음 | 주간 보안 리뷰, 침투 테스트 |
| **성능 목표 미달** | 중간 | 낮음 | Phase 4에 최적화 버퍼 1주 |

---

## 팀 역할 및 책임

### 프론트엔드 팀 (2명)

**Frontend Lead:**
- Phase 1: 인증 UI
- Phase 2: 랜딩페이지 에디터
- Phase 3: AI 채팅 UI
- Phase 4: Admin UI

**Frontend Developer:**
- UI 컴포넌트 라이브러리
- Tailwind CSS 스타일링
- E2E 테스트
- 성능 최적화

### 백엔드 팀 (2명)

**Backend Lead:**
- Phase 1: 인증 API
- Phase 2: 랜딩페이지 API
- Phase 3: AI API (Claude 연동)
- Phase 4: Admin API

**Backend Developer:**
- 데이터베이스 마이그레이션
- RLS 정책
- Rate Limiting
- 보안 로깅

### DevOps (1명)

**DevOps Engineer:**
- CI/CD 파이프라인
- Vercel 배포
- 모니터링 설정 (Sentry, Datadog)
- 보안 스캔 자동화
- 데이터베이스 백업

---

## 주간 미팅 일정

### 월요일: Planning Meeting (1시간)
- 이번 주 목표 확인
- 태스크 할당
- 블로커 논의

### 수요일: Mid-Week Sync (30분)
- 진행 상황 공유
- 문제 해결
- 일정 조정

### 금요일: Demo & Retrospective (1시간)
- 주간 산출물 데모
- 회고 (Keep, Problem, Try)
- 다음 주 계획

---

## 성공 지표 (KPI)

### 기술적 지표

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| **Lighthouse Performance** | 95+ | Lighthouse CI |
| **API 응답 시간** | < 200ms | Datadog APM |
| **보안 취약점** | 0개 (CRITICAL/HIGH) | npm audit, Snyk |
| **테스트 커버리지** | 80%+ | Jest Coverage |
| **버그 재발률** | < 5% | Jira 통계 |

### 비즈니스 지표

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| **회원가입 전환율** | 10%+ | Google Analytics |
| **랜딩페이지 생성 수** | 1,000+/월 | Supabase 쿼리 |
| **AI 채팅 사용률** | 50%+ (활성 사용자) | 사용 로그 |
| **평균 세션 시간** | 5분+ | Google Analytics |

---

## 배포 전략

### 환경 구성

```
Development → Staging → Production
```

**Development:**
- 로컬 개발 환경
- Supabase Development 프로젝트
- 자동 배포 없음

**Staging:**
- Vercel Preview Deployment
- Supabase Staging 프로젝트
- PR 생성 시 자동 배포
- QA 테스트 환경

**Production:**
- Vercel Production
- Supabase Production 프로젝트
- main 브랜치 머지 시 자동 배포
- 배포 전 수동 승인 필요

### 롤백 계획

```bash
# Vercel 이전 배포로 롤백
vercel rollback

# 데이터베이스 마이그레이션 롤백
supabase db reset --db-url $PRODUCTION_DB_URL
```

---

## 문서화 계획

### 개발자 문서

- [ ] API 문서 (OpenAPI/Swagger)
- [ ] 데이터베이스 스키마 문서
- [ ] 아키텍처 다이어그램 (Mermaid)
- [ ] 코드 스타일 가이드
- [ ] 기여 가이드 (CONTRIBUTING.md)

### 사용자 문서

- [ ] 사용자 가이드
- [ ] FAQ
- [ ] 비디오 튜토리얼
- [ ] 트러블슈팅 가이드

---

## 향후 계획 (Post-Launch)

### Phase 5: 고급 기능 (3개월)
- [ ] 다국어 지원 (i18n)
- [ ] A/B 테스트 시스템
- [ ] 분석 대시보드 (Google Analytics 통합)
- [ ] 결제 시스템 (Stripe)
- [ ] 이메일 마케팅 (Resend)

### Phase 6: AI 기능 확장 (3개월)
- [ ] 이미지 생성 (DALL-E, Midjourney)
- [ ] 음성 대화 (Whisper, ElevenLabs)
- [ ] 다중 모델 지원 (GPT-4, Gemini)
- [ ] RAG (Retrieval-Augmented Generation)
- [ ] 파인튜닝 (Magnetic Sales 특화)

### Phase 7: 엔터프라이즈 기능 (6개월)
- [ ] SSO (Single Sign-On)
- [ ] 팀 협업 기능
- [ ] 역할 기반 접근 제어 (RBAC)
- [ ] 감사 로그 (Audit Trail)
- [ ] SLA 보장 (99.9% Uptime)

---

## 부록: 참조 문서

### PRD v2 문서
1. [00_프로젝트_개요_v2.md](/mnt/c/Users/lpian/OneDrive/문서/db-automation/magnetic-sales-webapp/PRD_v2/00_프로젝트_개요_v2.md)
2. [01_인증_시스템_v2.md](/mnt/c/Users/lpian/OneDrive/문서/db-automation/magnetic-sales-webapp/PRD_v2/01_인증_시스템_v2.md)
3. [02_데이터베이스_v2.md](/mnt/c/Users/lpian/OneDrive/문서/db-automation/magnetic-sales-webapp/PRD_v2/02_데이터베이스_v2.md)
4. [03_API_엔드포인트_v2.md](/mnt/c/Users/lpian/OneDrive/문서/db-automation/magnetic-sales-webapp/PRD_v2/03_API_엔드포인트_v2.md)
5. [04_AI_통합_v2.md](/mnt/c/Users/lpian/OneDrive/문서/db-automation/magnetic-sales-webapp/PRD_v2/04_AI_통합_v2.md)
6. [05_프론트엔드_v2.md](/mnt/c/Users/lpian/OneDrive/문서/db-automation/magnetic-sales-webapp/PRD_v2/05_프론트엔드_v2.md)
7. [06_보안_체크리스트_v2.md](/mnt/c/Users/lpian/OneDrive/문서/db-automation/magnetic-sales-webapp/PRD_v2/06_보안_체크리스트_v2.md)
8. [07_구현_로드맵.md](/mnt/c/Users/lpian/OneDrive/문서/db-automation/magnetic-sales-webapp/PRD_v2/07_구현_로드맵.md) (이 문서)

### Red/Blue Team 리뷰
- [06_BlueTeam_PRD_개선안.md](/mnt/c/Users/lpian/OneDrive/문서/db-automation/magnetic-sales-webapp/리뷰/06_BlueTeam_PRD_개선안.md)

---

**작성일:** 2025-12-15
**버전:** v2 (Final)
**작성자:** Magnetic Sales WebApp 개발팀
**승인자:** CTO, Product Manager

**다음 검토:** Phase별 완료 시점 (Week 3, 6, 9, 12)
