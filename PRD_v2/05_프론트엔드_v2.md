# 05. í”„ë¡ íŠ¸ì—”ë“œ v2

## ê°œìš”

Magnetic Sales WebAppì˜ í”„ë¡ íŠ¸ì—”ë“œëŠ” Next.js 15.0.4 + React 19.0.0 ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¶•ë˜ë©°, Server Componentsì™€ Client Componentsë¥¼ ì „ëµì ìœ¼ë¡œ í™œìš©í•˜ì—¬ ì„±ëŠ¥ê³¼ SEOë¥¼ ìµœì í™”í•©ë‹ˆë‹¤.

**Red/Blue Team í”¼ë“œë°± ë°˜ì˜ ì‚¬í•­:**
- CRITICAL-001: Next.js 15.0.4 + React 19.0.0 ë²„ì „ í†µì¼
- HIGH-003: server-only íŒ¨í‚¤ì§€ë¡œ ë¯¼ê° ì •ë³´ ë³´í˜¸
- MEDIUM-007: 'use client' ì§€ì‹œì ìµœì†Œí™” ì „ëµ
- MEDIUM-008: í¼ ì œì¶œ Progressive Enhancement

---

## 1. ê¸°ìˆ  ìŠ¤íƒ

### 1.1 í•µì‹¬ í”„ë ˆì„ì›Œí¬

```json
{
  "dependencies": {
    "next": "15.0.4",
    "react": "19.0.0",
    "react-dom": "19.0.0",
    "@supabase/ssr": "^0.5.2",
    "@supabase/supabase-js": "^2.47.10"
  },
  "devDependencies": {
    "typescript": "^5.7.2",
    "eslint": "^9.17.0",
    "eslint-config-next": "15.0.4",
    "tailwindcss": "^3.4.17",
    "autoprefixer": "^10.4.20",
    "postcss": "^8.4.49"
  }
}
```

### 1.2 ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬

| ë¼ì´ë¸ŒëŸ¬ë¦¬ | ìš©ë„ | ë²„ì „ |
|-----------|------|------|
| **Tailwind CSS** | ìŠ¤íƒ€ì¼ë§ | 3.4.17 |
| **Radix UI** | ì ‘ê·¼ì„± ë†’ì€ UI ì»´í¬ë„ŒíŠ¸ | ^1.1.2 |
| **React Hook Form** | í¼ ê´€ë¦¬ | ^7.54.2 |
| **Zod** | ìŠ¤í‚¤ë§ˆ ê²€ì¦ | ^3.24.1 |
| **next-themes** | ë‹¤í¬ ëª¨ë“œ | ^0.4.4 |
| **server-only** | ì„œë²„ ì „ìš© ì½”ë“œ ë³´í˜¸ | ^0.0.1 |

---

## 2. í´ë” êµ¬ì¡°

```
src/
â”œâ”€â”€ app/                          # Next.js 15 App Router
â”‚   â”œâ”€â”€ layout.tsx                # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ (Server Component)
â”‚   â”œâ”€â”€ page.tsx                  # í™ˆí˜ì´ì§€ (Server Component)
â”‚   â”œâ”€â”€ (auth)/                   # ì¸ì¦ ë¼ìš°íŠ¸ ê·¸ë£¹
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # ë¡œê·¸ì¸ í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # íšŒì›ê°€ì… í˜ì´ì§€
â”‚   â”‚   â””â”€â”€ logout/
â”‚   â”‚       â””â”€â”€ page.tsx          # ë¡œê·¸ì•„ì›ƒ í˜ì´ì§€
â”‚   â”œâ”€â”€ (dashboard)/              # ëŒ€ì‹œë³´ë“œ ë¼ìš°íŠ¸ ê·¸ë£¹
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ (ì¸ì¦ í•„ìš”)
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # ëŒ€ì‹œë³´ë“œ ë©”ì¸
â”‚   â”‚   â”œâ”€â”€ ai-chat/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # AI ì±„íŒ…
â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚       â””â”€â”€ page.tsx          # í”„ë¡œí•„ ê´€ë¦¬
â”‚   â”œâ”€â”€ lp/
â”‚   â”‚   â”œâ”€â”€ [id]/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # ëœë”©í˜ì´ì§€ ë·°ì–´ (SSG)
â”‚   â”‚   â””â”€â”€ create/
â”‚   â”‚       â””â”€â”€ page.tsx          # ëœë”©í˜ì´ì§€ ìƒì„±
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # Admin ë ˆì´ì•„ì›ƒ
â”‚   â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # ì‚¬ìš©ì ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ ai-usage/
â”‚   â”‚       â””â”€â”€ page.tsx          # AI ì‚¬ìš©ëŸ‰ ëŒ€ì‹œë³´ë“œ
â”‚   â””â”€â”€ api/                      # API Routes
â”‚       â”œâ”€â”€ auth/
â”‚       â”‚   â”œâ”€â”€ login/route.ts
â”‚       â”‚   â”œâ”€â”€ signup/route.ts
â”‚       â”‚   â””â”€â”€ refresh/route.ts
â”‚       â”œâ”€â”€ ai/
â”‚       â”‚   â””â”€â”€ chat/route.ts
â”‚       â””â”€â”€ lp/
â”‚           â”œâ”€â”€ create/route.ts
â”‚           â””â”€â”€ [id]/route.ts
â”œâ”€â”€ components/                   # React ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ ui/                       # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ Button.tsx            # Client Component
â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â””â”€â”€ Dialog.tsx
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx         # Client Component
â”‚   â”‚   â”œâ”€â”€ SignupForm.tsx
â”‚   â”‚   â””â”€â”€ AuthGuard.tsx         # Server Component
â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”œâ”€â”€ AiChat.tsx            # Client Component (SSE)
â”‚   â”‚   â””â”€â”€ TokenBalance.tsx      # Client Component
â”‚   â””â”€â”€ lp/
â”‚       â”œâ”€â”€ LandingPageEditor.tsx # Client Component
â”‚       â””â”€â”€ LandingPagePreview.tsx
â”œâ”€â”€ lib/                          # ìœ í‹¸ë¦¬í‹° ë° í—¬í¼
â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”œâ”€â”€ client.ts             # í´ë¼ì´ì–¸íŠ¸ Supabase
â”‚   â”‚   â””â”€â”€ server.ts             # ì„œë²„ Supabase (server-only)
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ withAuth.ts           # ì„œë²„ ì¸ì¦ í—¬í¼
â”‚   â”‚   â””â”€â”€ session.ts
â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”œâ”€â”€ promptDefense.ts
â”‚   â”‚   â””â”€â”€ tokenManager.ts
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ cn.ts                 # className í•©ì„±
â”‚       â””â”€â”€ validators.ts         # Zod ìŠ¤í‚¤ë§ˆ
â”œâ”€â”€ hooks/                        # React Hooks (Client only)
â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”œâ”€â”€ useAiChat.ts
â”‚   â””â”€â”€ useDebounce.ts
â”œâ”€â”€ types/                        # TypeScript íƒ€ì…
â”‚   â”œâ”€â”€ database.types.ts         # Supabase ìƒì„± íƒ€ì…
â”‚   â”œâ”€â”€ api.types.ts
â”‚   â””â”€â”€ components.types.ts
â””â”€â”€ styles/
    â””â”€â”€ globals.css               # Tailwind CSS
```

---

## 3. Server Components vs Client Components

### 3.1 ì „ëµì  ì‚¬ìš© ì›ì¹™

**Server Components (ê¸°ë³¸ê°’):**
- ë°ì´í„° í˜ì¹­
- ë¯¼ê°í•œ ì •ë³´ ì ‘ê·¼ (API keys, secrets)
- SEOê°€ ì¤‘ìš”í•œ í˜ì´ì§€
- ì •ì  ì½˜í…ì¸  ë Œë”ë§

**Client Components ('use client'):**
- ìƒíƒœ ê´€ë¦¬ (useState, useReducer)
- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (onClick, onChange)
- ë¸Œë¼ìš°ì € API (window, document)
- ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ (React Hook Form, etc.)

### 3.2 Server Component ì˜ˆì‹œ

```typescript
// src/app/dashboard/page.tsx (Server Component - 'use client' ì—†ìŒ)
import { createClient } from '@/lib/supabase/server';
import { redirect } from 'next/navigation';
import DashboardClient from '@/components/dashboard/DashboardClient';

export default async function DashboardPage() {
  const supabase = createClient();

  // ì„œë²„ì—ì„œ ì§ì ‘ ë°ì´í„° í˜ì¹­
  const { data: { user }, error } = await supabase.auth.getUser();

  if (error || !user) {
    redirect('/login');
  }

  // ì‚¬ìš©ì í†µê³„ ì¡°íšŒ
  const { data: stats } = await supabase
    .from('user_stats')
    .select('landing_pages_created, ai_tokens_used')
    .eq('user_id', user.id)
    .single();

  // Client Componentì— propsë¡œ ì „ë‹¬
  return (
    <div>
      <h1>Dashboard</h1>
      <DashboardClient user={user} stats={stats} />
    </div>
  );
}
```

### 3.3 Client Component ì˜ˆì‹œ

```typescript
// src/components/dashboard/DashboardClient.tsx
'use client'; // Client Component ëª…ì‹œ

import { useState } from 'react';
import { User } from '@supabase/supabase-js';

interface Props {
  user: User;
  stats: {
    landing_pages_created: number;
    ai_tokens_used: number;
  };
}

export default function DashboardClient({ user, stats }: Props) {
  const [isExpanded, setIsExpanded] = useState(false);

  return (
    <div>
      <p>Welcome, {user.email}</p>

      <div className="stats">
        <div>Landing Pages: {stats.landing_pages_created}</div>
        <div>AI Tokens Used: {stats.ai_tokens_used}</div>
      </div>

      <button onClick={() => setIsExpanded(!isExpanded)}>
        {isExpanded ? 'Collapse' : 'Expand'}
      </button>

      {isExpanded && (
        <div>Additional details...</div>
      )}
    </div>
  );
}
```

### 3.4 'use client' ìµœì†Œí™” ì „ëµ

**Bad (ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ Client):**

```typescript
// âŒ ë¹„íš¨ìœ¨ì 
'use client';

export default function Page() {
  return (
    <div>
      <Header /> {/* ì •ì  ì»´í¬ë„ŒíŠ¸ë„ Clientë¡œ ë Œë”ë§ë¨ */}
      <InteractiveWidget /> {/* ì´ê²ƒë§Œ Client í•„ìš” */}
      <Footer /> {/* ì •ì  ì»´í¬ë„ŒíŠ¸ë„ Clientë¡œ ë Œë”ë§ë¨ */}
    </div>
  );
}
```

**Good (í•„ìš”í•œ ë¶€ë¶„ë§Œ Client):**

```typescript
// âœ… íš¨ìœ¨ì 
// src/app/page.tsx (Server Component)
import Header from '@/components/Header'; // Server Component
import InteractiveWidget from '@/components/InteractiveWidget'; // Client Component
import Footer from '@/components/Footer'; // Server Component

export default function Page() {
  return (
    <div>
      <Header /> {/* ì„œë²„ì—ì„œ ë Œë”ë§ */}
      <InteractiveWidget /> {/* í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë Œë”ë§ */}
      <Footer /> {/* ì„œë²„ì—ì„œ ë Œë”ë§ */}
    </div>
  );
}

// src/components/InteractiveWidget.tsx
'use client';

export default function InteractiveWidget() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}
```

---

## 4. ì¸ì¦ ë° ì„¸ì…˜ ê´€ë¦¬

### 4.1 ì„œë²„ ì„¸ì…˜ í™•ì¸

```typescript
// src/lib/supabase/server.ts
import 'server-only'; // CRITICAL: ì„œë²„ ì „ìš© ì½”ë“œ ë³´í˜¸
import { createServerClient } from '@supabase/ssr';
import { cookies } from 'next/headers';

export function createClient() {
  const cookieStore = cookies();

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) => {
            cookieStore.set(name, value, options);
          });
        },
      },
    }
  );
}
```

### 4.2 í´ë¼ì´ì–¸íŠ¸ ì„¸ì…˜ í™•ì¸

```typescript
// src/lib/supabase/client.ts
import { createBrowserClient } from '@supabase/ssr';

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );
}
```

### 4.3 ì¸ì¦ ê°€ë“œ (Server Component)

```typescript
// src/components/auth/AuthGuard.tsx (Server Component)
import { createClient } from '@/lib/supabase/server';
import { redirect } from 'next/navigation';

interface Props {
  children: React.ReactNode;
  redirectTo?: string;
}

export default async function AuthGuard({ children, redirectTo = '/login' }: Props) {
  const supabase = createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    redirect(redirectTo);
  }

  return <>{children}</>;
}

// ì‚¬ìš© ì˜ˆì‹œ
// src/app/(dashboard)/layout.tsx
import AuthGuard from '@/components/auth/AuthGuard';

export default function DashboardLayout({ children }) {
  return (
    <AuthGuard>
      <div className="dashboard-layout">
        {children}
      </div>
    </AuthGuard>
  );
}
```

### 4.4 ì¸ì¦ í›… (Client Component)

```typescript
// src/hooks/useAuth.ts
'use client';

import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';
import { User } from '@supabase/supabase-js';

export function useAuth() {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const supabase = createClient();

  useEffect(() => {
    // ì´ˆê¸° ì„¸ì…˜ í™•ì¸
    supabase.auth.getSession().then(({ data: { session } }) => {
      setUser(session?.user ?? null);
      setLoading(false);
    });

    // ì„¸ì…˜ ë³€ê²½ ê°ì§€
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (event, session) => {
        setUser(session?.user ?? null);
      }
    );

    return () => subscription.unsubscribe();
  }, [supabase]);

  return { user, loading };
}
```

---

## 5. í¼ ì²˜ë¦¬ (Progressive Enhancement)

### 5.1 Server Actions ì‚¬ìš©

```typescript
// src/app/(auth)/login/actions.ts
'use server';

import { createClient } from '@/lib/supabase/server';
import { redirect } from 'next/navigation';
import { z } from 'zod';

const loginSchema = z.object({
  email: z.string().email('Invalid email'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
});

export async function login(formData: FormData) {
  const rawData = {
    email: formData.get('email') as string,
    password: formData.get('password') as string,
  };

  // Zod ê²€ì¦
  const parsed = loginSchema.safeParse(rawData);
  if (!parsed.success) {
    return { error: parsed.error.flatten().fieldErrors };
  }

  const supabase = createClient();

  const { error } = await supabase.auth.signInWithPassword({
    email: parsed.data.email,
    password: parsed.data.password,
  });

  if (error) {
    return { error: { general: error.message } };
  }

  redirect('/dashboard');
}
```

### 5.2 Progressive Enhancement í¼

```typescript
// src/components/auth/LoginForm.tsx
'use client';

import { useFormState, useFormStatus } from 'react-dom';
import { login } from '@/app/(auth)/login/actions';

function SubmitButton() {
  const { pending } = useFormStatus();

  return (
    <button type="submit" disabled={pending}>
      {pending ? 'Logging in...' : 'Login'}
    </button>
  );
}

export default function LoginForm() {
  const [state, formAction] = useFormState(login, { error: null });

  return (
    <form action={formAction}>
      <div>
        <label htmlFor="email">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          required
          aria-describedby="email-error"
        />
        {state?.error?.email && (
          <p id="email-error" className="error">{state.error.email[0]}</p>
        )}
      </div>

      <div>
        <label htmlFor="password">Password</label>
        <input
          type="password"
          id="password"
          name="password"
          required
          minLength={8}
          aria-describedby="password-error"
        />
        {state?.error?.password && (
          <p id="password-error" className="error">{state.error.password[0]}</p>
        )}
      </div>

      {state?.error?.general && (
        <p className="error general">{state.error.general}</p>
      )}

      <SubmitButton />
    </form>
  );
}
```

**ì¥ì :**
1. JavaScript ë¹„í™œì„±í™” ì‹œì—ë„ ì‘ë™ (í¼ ì œì¶œ)
2. ì„œë²„ì—ì„œ ê²€ì¦ (ë³´ì•ˆ)
3. í´ë¼ì´ì–¸íŠ¸ UX í–¥ìƒ (ì¦‰ì‹œ í”¼ë“œë°±)

---

## 6. AI ì±„íŒ… UI (SSE ìŠ¤íŠ¸ë¦¬ë°)

### 6.1 AI Chat ì»´í¬ë„ŒíŠ¸

```typescript
// src/components/ai/AiChat.tsx
'use client';

import { useState, useRef, useEffect } from 'react';
import { useAuth } from '@/hooks/useAuth';

interface Message {
  role: 'user' | 'assistant';
  content: string;
}

export default function AiChat() {
  const { user } = useAuth();
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState('');
  const [isStreaming, setIsStreaming] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  // Auto-scroll to bottom
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const sendMessage = async () => {
    if (!input.trim() || isStreaming) return;

    const userMessage: Message = { role: 'user', content: input };
    setMessages(prev => [...prev, userMessage]);
    setInput('');
    setIsStreaming(true);

    try {
      const response = await fetch('/api/ai/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: input }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error);
      }

      // SSE ìŠ¤íŠ¸ë¦¼ ìˆ˜ì‹ 
      const reader = response.body!.getReader();
      const decoder = new TextDecoder();
      let assistantMessage = '';

      // ë¹ˆ ì–´ì‹œìŠ¤í„´íŠ¸ ë©”ì‹œì§€ ì¶”ê°€
      setMessages(prev => [...prev, { role: 'assistant', content: '' }]);

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunk = decoder.decode(value);
        const lines = chunk.split('\n\n');

        for (const line of lines) {
          if (line.startsWith('data: ')) {
            const data = JSON.parse(line.slice(6));

            if (data.text) {
              assistantMessage += data.text;
              setMessages(prev => {
                const newMessages = [...prev];
                newMessages[newMessages.length - 1].content = assistantMessage;
                return newMessages;
              });
            }

            if (data.done) {
              setIsStreaming(false);
            }

            if (data.error) {
              throw new Error(data.error);
            }
          }
        }
      }
    } catch (error) {
      console.error('AI chat error:', error);
      setMessages(prev => [
        ...prev,
        { role: 'assistant', content: 'Sorry, an error occurred. Please try again.' }
      ]);
      setIsStreaming(false);
    }
  };

  return (
    <div className="ai-chat-container">
      <div className="messages-list">
        {messages.map((msg, i) => (
          <div key={i} className={`message ${msg.role}`}>
            <strong>{msg.role === 'user' ? 'You' : 'AI'}:</strong>
            <p>{msg.content}</p>
          </div>
        ))}
        <div ref={messagesEndRef} />
      </div>

      <div className="input-area">
        <input
          type="text"
          value={input}
          onChange={(e) => setInput(e.target.value)}
          onKeyDown={(e) => e.key === 'Enter' && sendMessage()}
          disabled={isStreaming}
          placeholder="Ask about sales funnels, marketing strategies..."
        />
        <button onClick={sendMessage} disabled={isStreaming}>
          {isStreaming ? 'AI is typing...' : 'Send'}
        </button>
      </div>
    </div>
  );
}
```

### 6.2 í† í° ì”ì•¡ í‘œì‹œ

```typescript
// src/components/ai/TokenBalance.tsx
'use client';

import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';

export default function TokenBalance({ userId }: { userId: string }) {
  const [balance, setBalance] = useState<number | null>(null);
  const supabase = createClient();

  useEffect(() => {
    async function fetchBalance() {
      const { data } = await supabase
        .from('ai_tokens')
        .select('purchased_tokens, used_tokens')
        .eq('user_id', userId)
        .eq('is_deleted', false)
        .single();

      if (data) {
        setBalance(data.purchased_tokens - data.used_tokens);
      }
    }

    fetchBalance();

    // ì‹¤ì‹œê°„ êµ¬ë…
    const channel = supabase
      .channel('ai_tokens_changes')
      .on(
        'postgres_changes',
        {
          event: 'UPDATE',
          schema: 'public',
          table: 'ai_tokens',
          filter: `user_id=eq.${userId}`,
        },
        (payload) => {
          const newData = payload.new as any;
          setBalance(newData.purchased_tokens - newData.used_tokens);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [userId, supabase]);

  if (balance === null) return <div>Loading...</div>;

  return (
    <div className="token-balance">
      <span>AI Tokens: {balance.toLocaleString()}</span>
      {balance < 1000 && (
        <a href="/pricing" className="buy-tokens">Buy More</a>
      )}
    </div>
  );
}
```

---

## 7. ëœë”©í˜ì´ì§€ ì—ë””í„°

### 7.1 ì—ë””í„° ì»´í¬ë„ŒíŠ¸

```typescript
// src/components/lp/LandingPageEditor.tsx
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';

interface Section {
  type: 'hero' | 'features' | 'pricing' | 'cta';
  content: Record<string, any>;
}

export default function LandingPageEditor() {
  const router = useRouter();
  const [title, setTitle] = useState('');
  const [sections, setSections] = useState<Section[]>([]);
  const [isSaving, setIsSaving] = useState(false);

  const addSection = (type: Section['type']) => {
    setSections(prev => [...prev, { type, content: {} }]);
  };

  const saveLandingPage = async () => {
    setIsSaving(true);

    try {
      const response = await fetch('/api/lp/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          title,
          sections,
        }),
      });

      if (!response.ok) {
        throw new Error('Failed to save landing page');
      }

      const { id } = await response.json();
      router.push(`/lp/${id}`);
    } catch (error) {
      console.error('Save error:', error);
      alert('Failed to save landing page');
    } finally {
      setIsSaving(false);
    }
  };

  return (
    <div className="editor-container">
      <div className="editor-header">
        <input
          type="text"
          value={title}
          onChange={(e) => setTitle(e.target.value)}
          placeholder="Landing Page Title"
          className="title-input"
        />
        <button onClick={saveLandingPage} disabled={isSaving}>
          {isSaving ? 'Saving...' : 'Save & Publish'}
        </button>
      </div>

      <div className="editor-sections">
        {sections.map((section, index) => (
          <div key={index} className="section-block">
            <h3>{section.type.toUpperCase()}</h3>
            {/* Section-specific editor UI */}
          </div>
        ))}
      </div>

      <div className="section-toolbar">
        <button onClick={() => addSection('hero')}>+ Hero</button>
        <button onClick={() => addSection('features')}>+ Features</button>
        <button onClick={() => addSection('pricing')}>+ Pricing</button>
        <button onClick={() => addSection('cta')}>+ CTA</button>
      </div>
    </div>
  );
}
```

### 7.2 í”„ë¦¬ë·° ì»´í¬ë„ŒíŠ¸

```typescript
// src/components/lp/LandingPagePreview.tsx
'use client';

import { Section } from './LandingPageEditor';

interface Props {
  title: string;
  sections: Section[];
}

export default function LandingPagePreview({ title, sections }: Props) {
  return (
    <div className="preview-container">
      <h1>{title}</h1>

      {sections.map((section, index) => {
        switch (section.type) {
          case 'hero':
            return <HeroSection key={index} {...section.content} />;
          case 'features':
            return <FeaturesSection key={index} {...section.content} />;
          case 'pricing':
            return <PricingSection key={index} {...section.content} />;
          case 'cta':
            return <CTASection key={index} {...section.content} />;
          default:
            return null;
        }
      })}
    </div>
  );
}

function HeroSection({ headline, subheadline, ctaText }) {
  return (
    <section className="hero">
      <h1>{headline}</h1>
      <p>{subheadline}</p>
      <button>{ctaText}</button>
    </section>
  );
}

// ë‚˜ë¨¸ì§€ ì„¹ì…˜ ì»´í¬ë„ŒíŠ¸ë“¤...
```

---

## 8. UI ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬

### 8.1 Button ì»´í¬ë„ŒíŠ¸

```typescript
// src/components/ui/Button.tsx
'use client';

import { forwardRef } from 'react';
import { cn } from '@/lib/utils/cn';

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  isLoading?: boolean;
}

const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant = 'primary', size = 'md', isLoading, children, ...props }, ref) => {
    return (
      <button
        ref={ref}
        className={cn(
          'inline-flex items-center justify-center rounded-md font-medium transition-colors',
          'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2',
          'disabled:pointer-events-none disabled:opacity-50',
          {
            'bg-blue-600 text-white hover:bg-blue-700': variant === 'primary',
            'bg-gray-200 text-gray-900 hover:bg-gray-300': variant === 'secondary',
            'border border-gray-300 bg-transparent hover:bg-gray-100': variant === 'outline',
            'hover:bg-gray-100': variant === 'ghost',
          },
          {
            'h-8 px-3 text-sm': size === 'sm',
            'h-10 px-4 text-base': size === 'md',
            'h-12 px-6 text-lg': size === 'lg',
          },
          className
        )}
        disabled={isLoading || props.disabled}
        {...props}
      >
        {isLoading && (
          <svg
            className="mr-2 h-4 w-4 animate-spin"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              className="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              strokeWidth="4"
            />
            <path
              className="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"
            />
          </svg>
        )}
        {children}
      </button>
    );
  }
);

Button.displayName = 'Button';

export default Button;
```

### 8.2 Input ì»´í¬ë„ŒíŠ¸

```typescript
// src/components/ui/Input.tsx
'use client';

import { forwardRef } from 'react';
import { cn } from '@/lib/utils/cn';

interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label?: string;
  error?: string;
}

const Input = forwardRef<HTMLInputElement, InputProps>(
  ({ className, label, error, id, ...props }, ref) => {
    const inputId = id || `input-${Math.random().toString(36).slice(2, 9)}`;

    return (
      <div className="w-full">
        {label && (
          <label htmlFor={inputId} className="mb-1 block text-sm font-medium text-gray-700">
            {label}
          </label>
        )}
        <input
          ref={ref}
          id={inputId}
          className={cn(
            'flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm',
            'placeholder:text-gray-400',
            'focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent',
            'disabled:cursor-not-allowed disabled:opacity-50',
            error && 'border-red-500 focus:ring-red-500',
            className
          )}
          aria-invalid={error ? 'true' : 'false'}
          aria-describedby={error ? `${inputId}-error` : undefined}
          {...props}
        />
        {error && (
          <p id={`${inputId}-error`} className="mt-1 text-sm text-red-600">
            {error}
          </p>
        )}
      </div>
    );
  }
);

Input.displayName = 'Input';

export default Input;
```

### 8.3 Card ì»´í¬ë„ŒíŠ¸

```typescript
// src/components/ui/Card.tsx
import { cn } from '@/lib/utils/cn';

interface CardProps extends React.HTMLAttributes<HTMLDivElement> {}

export function Card({ className, ...props }: CardProps) {
  return (
    <div
      className={cn(
        'rounded-lg border border-gray-200 bg-white shadow-sm',
        className
      )}
      {...props}
    />
  );
}

export function CardHeader({ className, ...props }: CardProps) {
  return <div className={cn('p-6', className)} {...props} />;
}

export function CardTitle({ className, ...props }: CardProps) {
  return <h3 className={cn('text-lg font-semibold', className)} {...props} />;
}

export function CardContent({ className, ...props }: CardProps) {
  return <div className={cn('p-6 pt-0', className)} {...props} />;
}

export function CardFooter({ className, ...props }: CardProps) {
  return <div className={cn('p-6 pt-0', className)} {...props} />;
}
```

---

## 9. ìŠ¤íƒ€ì¼ë§ (Tailwind CSS)

### 9.1 globals.css

```css
/* src/styles/globals.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;

    --primary: 221.2 83.2% 53.3%;
    --primary-foreground: 210 40% 98%;

    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;

    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;

    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;

    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 221.2 83.2% 53.3%;

    --radius: 0.5rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;

    --primary: 217.2 91.2% 59.8%;
    --primary-foreground: 222.2 47.4% 11.2%;

    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;

    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;

    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;

    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 224.3 76.3% 48%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}
```

### 9.2 tailwind.config.js

```javascript
/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: 'class',
  content: [
    './src/pages/**/*.{js,ts,jsx,tsx,mdx}',
    './src/components/**/*.{js,ts,jsx,tsx,mdx}',
    './src/app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        border: 'hsl(var(--border))',
        input: 'hsl(var(--input))',
        ring: 'hsl(var(--ring))',
        background: 'hsl(var(--background))',
        foreground: 'hsl(var(--foreground))',
        primary: {
          DEFAULT: 'hsl(var(--primary))',
          foreground: 'hsl(var(--primary-foreground))',
        },
        secondary: {
          DEFAULT: 'hsl(var(--secondary))',
          foreground: 'hsl(var(--secondary-foreground))',
        },
        destructive: {
          DEFAULT: 'hsl(var(--destructive))',
          foreground: 'hsl(var(--destructive-foreground))',
        },
        muted: {
          DEFAULT: 'hsl(var(--muted))',
          foreground: 'hsl(var(--muted-foreground))',
        },
        accent: {
          DEFAULT: 'hsl(var(--accent))',
          foreground: 'hsl(var(--accent-foreground))',
        },
      },
      borderRadius: {
        lg: 'var(--radius)',
        md: 'calc(var(--radius) - 2px)',
        sm: 'calc(var(--radius) - 4px)',
      },
    },
  },
  plugins: [require('@tailwindcss/forms')],
};
```

---

## 10. ì ‘ê·¼ì„± (a11y)

### 10.1 í•„ìˆ˜ ìš”ì†Œ

1. **Semantic HTML**
```typescript
// âœ… Good
<button onClick={handleClick}>Submit</button>

// âŒ Bad
<div onClick={handleClick}>Submit</div>
```

2. **ARIA ë ˆì´ë¸”**
```typescript
<button aria-label="Close dialog" onClick={close}>
  <X className="h-4 w-4" />
</button>
```

3. **í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜**
```typescript
<div
  role="button"
  tabIndex={0}
  onClick={handleClick}
  onKeyDown={(e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      handleClick();
    }
  }}
>
  Click me
</div>
```

4. **í¬ì»¤ìŠ¤ ê´€ë¦¬**
```typescript
const dialogRef = useRef<HTMLDivElement>(null);

useEffect(() => {
  if (isOpen) {
    dialogRef.current?.focus();
  }
}, [isOpen]);

return (
  <div ref={dialogRef} tabIndex={-1}>
    Dialog content
  </div>
);
```

### 10.2 ëŒ€ë¹„ ë¹„ìœ¨ (WCAG AA)

- ì¼ë°˜ í…ìŠ¤íŠ¸: ìµœì†Œ 4.5:1
- í° í…ìŠ¤íŠ¸ (18pt+): ìµœì†Œ 3:1
- UI ì»´í¬ë„ŒíŠ¸: ìµœì†Œ 3:1

```css
/* Good contrast */
.button-primary {
  background: #0066cc; /* íŒŒë€ìƒ‰ */
  color: #ffffff; /* í°ìƒ‰ - ëŒ€ë¹„ 4.57:1 */
}

/* Bad contrast */
.button-bad {
  background: #cccccc; /* íšŒìƒ‰ */
  color: #ffffff; /* í°ìƒ‰ - ëŒ€ë¹„ 1.6:1 (ë¶ˆì¶©ë¶„) */
}
```

---

## 11. ì„±ëŠ¥ ìµœì í™”

### 11.1 ì´ë¯¸ì§€ ìµœì í™”

```typescript
// Next.js Image ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
import Image from 'next/image';

export default function Hero() {
  return (
    <Image
      src="/hero.jpg"
      alt="Hero image"
      width={1200}
      height={600}
      priority // LCP ìµœì í™”
      placeholder="blur"
      blurDataURL="data:image/jpeg;base64,/9j/4AAQSkZJRg..." // íë¦¼ íš¨ê³¼
    />
  );
}
```

### 11.2 í°íŠ¸ ìµœì í™”

```typescript
// src/app/layout.tsx
import { Inter } from 'next/font/google';

const inter = Inter({
  subsets: ['latin'],
  display: 'swap', // FOUT ë°©ì§€
  variable: '--font-inter',
});

export default function RootLayout({ children }) {
  return (
    <html lang="ko" className={inter.variable}>
      <body>{children}</body>
    </html>
  );
}
```

### 11.3 ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…

```typescript
// ë™ì  importë¡œ ë²ˆë“¤ í¬ê¸° ì¶•ì†Œ
import dynamic from 'next/dynamic';

const AiChat = dynamic(() => import('@/components/ai/AiChat'), {
  loading: () => <p>Loading AI chat...</p>,
  ssr: false, // í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ë¡œë“œ
});

export default function AiChatPage() {
  return <AiChat />;
}
```

### 11.4 ë°ì´í„° ìºì‹±

```typescript
// Server Componentì—ì„œ ìë™ ìºì‹±
export default async function DashboardPage() {
  const data = await fetch('https://api.example.com/stats', {
    next: {
      revalidate: 3600, // 1ì‹œê°„ë§ˆë‹¤ ì¬ê²€ì¦
    },
  });

  return <div>{/* data ì‚¬ìš© */}</div>;
}

// ë˜ëŠ” Supabase ìºì‹±
const { data, error } = await supabase
  .from('landing_pages')
  .select('*')
  .cache(3600); // 1ì‹œê°„ ìºì‹±
```

---

## 12. SEO ìµœì í™”

### 12.1 ë©”íƒ€ë°ì´í„°

```typescript
// src/app/layout.tsx
import type { Metadata } from 'next';

export const metadata: Metadata = {
  title: {
    default: 'Magnetic Sales WebApp',
    template: '%s | Magnetic Sales',
  },
  description: 'AI-powered landing page builder and sales funnel optimizer',
  keywords: ['landing page', 'sales funnel', 'AI', 'marketing'],
  authors: [{ name: 'Magnetic Sales Team' }],
  openGraph: {
    type: 'website',
    locale: 'ko_KR',
    url: 'https://magneticsales.com',
    title: 'Magnetic Sales WebApp',
    description: 'AI-powered landing page builder',
    siteName: 'Magnetic Sales',
    images: [
      {
        url: 'https://magneticsales.com/og-image.jpg',
        width: 1200,
        height: 630,
        alt: 'Magnetic Sales',
      },
    ],
  },
  twitter: {
    card: 'summary_large_image',
    title: 'Magnetic Sales WebApp',
    description: 'AI-powered landing page builder',
    images: ['https://magneticsales.com/twitter-image.jpg'],
  },
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      'max-video-preview': -1,
      'max-image-preview': 'large',
      'max-snippet': -1,
    },
  },
};
```

### 12.2 ë™ì  ë©”íƒ€ë°ì´í„°

```typescript
// src/app/lp/[id]/page.tsx
import { Metadata } from 'next';
import { createClient } from '@/lib/supabase/server';

export async function generateMetadata({ params }): Promise<Metadata> {
  const supabase = createClient();
  const { data: lp } = await supabase
    .from('landing_pages')
    .select('title, description')
    .eq('id', params.id)
    .single();

  return {
    title: lp?.title || 'Landing Page',
    description: lp?.description || 'View this landing page',
  };
}

export default async function LandingPage({ params }) {
  // í˜ì´ì§€ ë Œë”ë§
}
```

### 12.3 Sitemap

```typescript
// src/app/sitemap.ts
import { MetadataRoute } from 'next';
import { createClient } from '@/lib/supabase/server';

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const supabase = createClient();

  const { data: landingPages } = await supabase
    .from('landing_pages')
    .select('id, updated_at')
    .eq('is_deleted', false);

  return [
    {
      url: 'https://magneticsales.com',
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 1,
    },
    {
      url: 'https://magneticsales.com/pricing',
      lastModified: new Date(),
      changeFrequency: 'weekly',
      priority: 0.8,
    },
    ...(landingPages || []).map((lp) => ({
      url: `https://magneticsales.com/lp/${lp.id}`,
      lastModified: new Date(lp.updated_at),
      changeFrequency: 'monthly' as const,
      priority: 0.5,
    })),
  ];
}
```

---

## 13. ë‹¤í¬ ëª¨ë“œ

### 13.1 next-themes ì„¤ì •

```typescript
// src/app/layout.tsx
import { ThemeProvider } from 'next-themes';

export default function RootLayout({ children }) {
  return (
    <html lang="ko" suppressHydrationWarning>
      <body>
        <ThemeProvider attribute="class" defaultTheme="system" enableSystem>
          {children}
        </ThemeProvider>
      </body>
    </html>
  );
}
```

### 13.2 í…Œë§ˆ ì „í™˜ ë²„íŠ¼

```typescript
// src/components/ui/ThemeToggle.tsx
'use client';

import { useTheme } from 'next-themes';
import { useEffect, useState } from 'react';

export default function ThemeToggle() {
  const { theme, setTheme } = useTheme();
  const [mounted, setMounted] = useState(false);

  useEffect(() => setMounted(true), []);

  if (!mounted) return null; // Hydration mismatch ë°©ì§€

  return (
    <button
      onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}
      className="rounded-md p-2 hover:bg-gray-100 dark:hover:bg-gray-800"
    >
      {theme === 'dark' ? 'ğŸŒ' : 'ğŸŒ™'}
    </button>
  );
}
```

---

## 14. ì—ëŸ¬ ì²˜ë¦¬

### 14.1 Error Boundary

```typescript
// src/app/error.tsx
'use client';

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  return (
    <div className="error-page">
      <h2>Something went wrong!</h2>
      <p>{error.message}</p>
      <button onClick={() => reset()}>Try again</button>
    </div>
  );
}
```

### 14.2 404 í˜ì´ì§€

```typescript
// src/app/not-found.tsx
import Link from 'next/link';

export default function NotFound() {
  return (
    <div className="not-found">
      <h1>404 - Page Not Found</h1>
      <p>The page you are looking for does not exist.</p>
      <Link href="/">Go back home</Link>
    </div>
  );
}
```

---

## 15. í…ŒìŠ¤íŠ¸

### 15.1 ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ (Jest + React Testing Library)

```typescript
// __tests__/components/Button.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import Button from '@/components/ui/Button';

describe('Button', () => {
  it('renders correctly', () => {
    render(<Button>Click me</Button>);
    expect(screen.getByText('Click me')).toBeInTheDocument();
  });

  it('handles click events', () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick}>Click</Button>);

    fireEvent.click(screen.getByText('Click'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  it('disables when isLoading is true', () => {
    render(<Button isLoading>Submit</Button>);
    expect(screen.getByRole('button')).toBeDisabled();
  });
});
```

### 15.2 E2E í…ŒìŠ¤íŠ¸ (Playwright)

```typescript
// e2e/login.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Login Flow', () => {
  test('successful login redirects to dashboard', async ({ page }) => {
    await page.goto('/login');

    await page.fill('input[name="email"]', 'test@example.com');
    await page.fill('input[name="password"]', 'password123');
    await page.click('button[type="submit"]');

    await expect(page).toHaveURL('/dashboard');
    await expect(page.locator('h1')).toContainText('Dashboard');
  });

  test('shows error on invalid credentials', async ({ page }) => {
    await page.goto('/login');

    await page.fill('input[name="email"]', 'wrong@example.com');
    await page.fill('input[name="password"]', 'wrongpassword');
    await page.click('button[type="submit"]');

    await expect(page.locator('.error')).toBeVisible();
  });
});
```

---

## 16. ë°°í¬

### 16.1 Vercel ë°°í¬ ì„¤ì •

```json
// vercel.json
{
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "nextjs",
  "outputDirectory": ".next",
  "env": {
    "NEXT_PUBLIC_SUPABASE_URL": "@supabase_url",
    "NEXT_PUBLIC_SUPABASE_ANON_KEY": "@supabase_anon_key",
    "SUPABASE_SERVICE_ROLE_KEY": "@supabase_service_role_key",
    "ANTHROPIC_API_KEY": "@anthropic_api_key"
  }
}
```

### 16.2 ë¹Œë“œ ìµœì í™”

```javascript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,
  images: {
    domains: ['magneticsales.com'],
    formats: ['image/avif', 'image/webp'],
  },
  experimental: {
    serverActions: {
      bodySizeLimit: '2mb',
    },
  },
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production',
  },
};

module.exports = nextConfig;
```

---

## 17. ì°¸ê³  ìë£Œ

- [Next.js 15 Documentation](https://nextjs.org/docs)
- [React 19 Documentation](https://react.dev)
- [Supabase SSR Guide](https://supabase.com/docs/guides/auth/server-side/nextjs)
- [Tailwind CSS](https://tailwindcss.com/docs)
- [Radix UI](https://www.radix-ui.com/)

---

**ì‘ì„±ì¼:** 2025-12-15
**ë²„ì „:** v2 (Red/Blue Team í”¼ë“œë°± ë°˜ì˜)
**ì‘ì„±ì:** Magnetic Sales WebApp ê°œë°œíŒ€
