# 마그네틱 세일즈 웹앱 - PRD v1.0

## 문서 정보

| 항목 | 내용 |
|------|------|
| 버전 | PRD v1.0 |
| 작성일 | 2025-01-15 |
| 기반 문서 | 기획_v2 (Red Team 최종 승인) |
| 상태 | 개발팀 구현 준비 완료 |

---

## 1. 개요

### 1.1 프로젝트 목표

**"AI 기반 마그네틱 세일즈 랜딩페이지 자동 생성 SaaS"**

비개발자도 40개 질문에 답변하면 AI가 전환율 높은 마그네틱 세일즈 랜딩페이지를 자동으로 생성해주는 서비스입니다.

### 1.2 핵심 가치

| 가치 | 설명 |
|------|------|
| 간편함 | 복잡한 기술 지식 없이 질문 답변만으로 완성 |
| 효과성 | 검증된 마그네틱 세일즈 18단계 프레임워크 적용 |
| 경제성 | 전문 카피라이터 대비 90% 이상 비용 절감 |

### 1.3 타겟 사용자

- 1인 창업자 / 프리랜서
- 소규모 비즈니스 운영자
- 마케터 / 세일즈 담당자
- 코칭/컨설팅 서비스 제공자

---

## 2. 기술 스택

### 2.1 프론트엔드

```yaml
Framework: Next.js 14 (App Router)
Language: TypeScript 5.x
Styling: Tailwind CSS 3.x
State Management: Zustand 4.x
Form Validation: Zod 3.x
Rich Text Editor: TipTap 2.x
Sanitization: DOMPurify 3.x
Icons: Lucide React
```

### 2.2 백엔드

```yaml
BaaS: Supabase
  - PostgreSQL 15 (Database)
  - Supabase Auth (인증)
  - Supabase Storage (파일 저장)
  - Row Level Security (RLS)
  - Edge Functions (서버리스)

API: Next.js API Routes
Rate Limiting: PostgreSQL 기반 (Supabase)
```

### 2.3 AI

```yaml
Provider: Anthropic Claude API
Model: claude-sonnet-4-20250514
Token Management: 2-Phase (Reserved -> Confirmed)
Timeout: 90초
```

### 2.4 인프라

```yaml
Hosting: Vercel
  - Edge Network (CDN)
  - Serverless Functions
  - Preview Deployments

Monitoring:
  - Vercel Analytics
  - Sentry (Error Tracking)

CI/CD: GitHub Actions + Vercel
```

---

## 3. 폴더 구조

```
magnetic-sales-webapp/
├── src/
│   ├── app/                          # Next.js App Router
│   │   ├── (auth)/                   # 인증 관련 페이지
│   │   │   ├── login/
│   │   │   │   └── page.tsx
│   │   │   ├── signup/
│   │   │   │   └── page.tsx
│   │   │   └── layout.tsx
│   │   │
│   │   ├── (dashboard)/              # 대시보드 (인증 필요)
│   │   │   ├── dashboard/
│   │   │   │   └── page.tsx
│   │   │   ├── create/
│   │   │   │   └── page.tsx
│   │   │   ├── edit/[id]/
│   │   │   │   └── page.tsx
│   │   │   └── layout.tsx
│   │   │
│   │   ├── (public)/                 # 공개 페이지
│   │   │   ├── lp/[slug]/
│   │   │   │   └── page.tsx
│   │   │   └── layout.tsx
│   │   │
│   │   ├── api/                      # API Routes
│   │   │   ├── auth/
│   │   │   │   ├── login/route.ts
│   │   │   │   ├── signup/route.ts
│   │   │   │   ├── logout/route.ts
│   │   │   │   └── refresh/route.ts
│   │   │   ├── ai/
│   │   │   │   ├── generate/route.ts
│   │   │   │   ├── regenerate/route.ts
│   │   │   │   └── tokens/route.ts
│   │   │   ├── lp/
│   │   │   │   ├── route.ts
│   │   │   │   ├── [id]/route.ts
│   │   │   │   ├── [id]/restore/route.ts
│   │   │   │   └── deleted/route.ts
│   │   │   └── admin/
│   │   │       ├── users/route.ts
│   │   │       └── audit-logs/route.ts
│   │   │
│   │   ├── layout.tsx
│   │   ├── page.tsx
│   │   └── globals.css
│   │
│   ├── components/                   # React 컴포넌트
│   │   ├── ui/                       # 기본 UI 컴포넌트
│   │   │   ├── Button.tsx
│   │   │   ├── Input.tsx
│   │   │   ├── Card.tsx
│   │   │   ├── Modal.tsx
│   │   │   └── Toast.tsx
│   │   │
│   │   ├── auth/                     # 인증 관련
│   │   │   ├── LoginForm.tsx
│   │   │   ├── SignupForm.tsx
│   │   │   └── AuthGuard.tsx
│   │   │
│   │   ├── qa/                       # Q&A 시스템
│   │   │   ├── QuestionCard.tsx
│   │   │   ├── AnswerInput.tsx
│   │   │   ├── ProgressBar.tsx
│   │   │   └── QASession.tsx
│   │   │
│   │   ├── editor/                   # 랜딩페이지 에디터
│   │   │   ├── LPEditor.tsx
│   │   │   ├── SectionEditor.tsx
│   │   │   ├── ImageUploader.tsx
│   │   │   └── PreviewPane.tsx
│   │   │
│   │   └── dashboard/                # 대시보드
│   │       ├── LPList.tsx
│   │       ├── TokenUsage.tsx
│   │       └── DeletedItems.tsx
│   │
│   ├── lib/                          # 유틸리티 및 설정
│   │   ├── supabase/
│   │   │   ├── client.ts             # 클라이언트용 Supabase
│   │   │   ├── server.ts             # 서버용 Supabase
│   │   │   └── admin.ts              # Admin Supabase
│   │   │
│   │   ├── auth/
│   │   │   ├── session.ts            # 세션 관리
│   │   │   ├── tokens.ts             # 토큰 관리
│   │   │   └── middleware.ts         # 인증 미들웨어
│   │   │
│   │   ├── ai/
│   │   │   ├── claude.ts             # Claude API 클라이언트
│   │   │   ├── prompts.ts            # 프롬프트 템플릿
│   │   │   ├── sanitizer.ts          # 입력 새니타이저
│   │   │   └── validator.ts          # 출력 검증기
│   │   │
│   │   ├── security/
│   │   │   ├── cors.ts               # CORS 설정
│   │   │   ├── rate-limit.ts         # Rate Limiting
│   │   │   ├── crypto.ts             # 암호화 유틸
│   │   │   └── sanitize.ts           # DOMPurify 설정
│   │   │
│   │   └── utils/
│   │       ├── errors.ts             # 에러 코드 정의
│   │       ├── validators.ts         # Zod 스키마
│   │       └── helpers.ts            # 헬퍼 함수
│   │
│   ├── hooks/                        # Custom Hooks
│   │   ├── useAuth.ts
│   │   ├── useQASession.ts
│   │   ├── useTokens.ts
│   │   └── useLandingPage.ts
│   │
│   ├── stores/                       # Zustand Stores
│   │   ├── authStore.ts
│   │   ├── qaStore.ts
│   │   └── editorStore.ts
│   │
│   └── types/                        # TypeScript 타입
│       ├── auth.ts
│       ├── database.ts
│       ├── api.ts
│       └── ai.ts
│
├── supabase/                         # Supabase 설정
│   ├── migrations/                   # DB 마이그레이션
│   │   ├── 001_initial_schema.sql
│   │   ├── 002_soft_delete.sql
│   │   ├── 003_refresh_tokens.sql
│   │   ├── 004_audit_logs.sql
│   │   ├── 005_rate_limits.sql
│   │   └── 006_token_reservations.sql
│   │
│   ├── functions/                    # Edge Functions
│   │   └── cleanup-expired/
│   │
│   └── config.toml
│
├── public/                           # 정적 파일
│   ├── images/
│   └── favicon.ico
│
├── tests/                            # 테스트
│   ├── unit/
│   ├── integration/
│   └── e2e/
│
├── .env.local                        # 로컬 환경 변수
├── .env.example                      # 환경 변수 예시
├── next.config.js                    # Next.js 설정
├── tailwind.config.js                # Tailwind 설정
├── tsconfig.json                     # TypeScript 설정
├── package.json
└── README.md
```

---

## 4. 환경 변수

### 4.1 환경 변수 파일 (.env.example)

```bash
# ===========================================
# Supabase
# ===========================================
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Direct Database Connection (마이그레이션용)
SUPABASE_DB_HOST=db.your-project.supabase.co
SUPABASE_DB_PORT=5432
SUPABASE_DB_USER=postgres
SUPABASE_DB_PASSWORD=your-password
SUPABASE_DB_NAME=postgres

# ===========================================
# Claude API
# ===========================================
ANTHROPIC_API_KEY=sk-ant-api03-...

# ===========================================
# Security
# ===========================================
# JWT Secret (최소 32자)
JWT_SECRET=your-super-secret-jwt-key-minimum-32-chars

# Refresh Token Secret (최소 32자)
REFRESH_TOKEN_SECRET=your-refresh-token-secret-minimum-32-chars

# ===========================================
# CORS (쉼표로 구분)
# ===========================================
ADDITIONAL_CORS_ORIGINS=https://staging.magnetic-sales.vercel.app

# ===========================================
# Application
# ===========================================
NEXT_PUBLIC_APP_URL=https://magnetic-sales.vercel.app
NEXT_PUBLIC_LP_DOMAIN=https://lp.magnetic-sales.com

# ===========================================
# Monitoring (Optional)
# ===========================================
SENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx
NEXT_PUBLIC_SENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx

# ===========================================
# Development Only
# ===========================================
# NODE_ENV=development
```

### 4.2 환경별 설정

| 환경 | NODE_ENV | 특징 |
|------|----------|------|
| Development | development | localhost:3000, 디버그 로그 |
| Preview | production | Vercel Preview, 테스트 DB |
| Production | production | 프로덕션 DB, 에러 모니터링 |

---

## 5. 핵심 기능 요약

### 5.1 사용자 등급

| 등급 | 일일 토큰 | 랜딩페이지 수 | 가격 |
|------|----------|--------------|------|
| FREE | 100,000 | 3개 | 무료 |
| PRO | 500,000 | 무제한 | $29/월 |
| ENTERPRISE | 2,000,000 | 무제한 | $99/월 |

### 5.2 주요 보안 기능 (v2)

| 기능 | 구현 방식 |
|------|----------|
| CORS | 명시적 화이트리스트 (와일드카드 금지) |
| JWT 저장 | HttpOnly Cookie + Refresh Token Rotation |
| 토큰 관리 | 2-Phase (Reserve -> Confirm) + Advisory Lock |
| 삭제 | Soft Delete (30일 복구 기간) |
| Rate Limiting | PostgreSQL 기반 슬라이딩 윈도우 |
| XSS 방지 | DOMPurify + CSP 헤더 |
| Prompt Injection | 다중 레이어 방어 (입력/시스템/출력) |

---

## 6. 관련 PRD 문서

| 문서 | 파일명 | 내용 |
|------|--------|------|
| 인증 시스템 | 01_인증_시스템.md | Supabase Auth, JWT, Refresh Token |
| 데이터베이스 | 02_데이터베이스.md | 테이블 스키마, RLS, 마이그레이션 |
| API 엔드포인트 | 03_API_엔드포인트.md | REST API, CORS, Rate Limiting |
| AI 통합 | 04_AI_통합.md | Claude API, 프롬프트, 토큰 관리 |
| 프론트엔드 | 05_프론트엔드.md | 페이지 구조, 컴포넌트, 상태 관리 |
| 보안 체크리스트 | 06_보안_체크리스트.md | OWASP, 감사 로그, 테스트 계획 |

---

## 7. 구현 일정

### Phase 1: 핵심 인프라 (1주차)

- [ ] Supabase 프로젝트 설정
- [ ] Next.js 프로젝트 초기화
- [ ] 환경 변수 설정
- [ ] 기본 폴더 구조 생성

### Phase 2: 인증 시스템 (1-2주차)

- [ ] Supabase Auth 연동
- [ ] 회원가입/로그인 구현
- [ ] JWT HttpOnly Cookie 구현
- [ ] Refresh Token Rotation 구현

### Phase 3: 데이터베이스 (2주차)

- [ ] 테이블 마이그레이션
- [ ] RLS 정책 설정
- [ ] Advisory Lock 함수 구현
- [ ] Soft Delete 구현

### Phase 4: API 개발 (2-3주차)

- [ ] CORS 미들웨어
- [ ] Rate Limiting
- [ ] 랜딩페이지 CRUD API
- [ ] 토큰 관리 API

### Phase 5: AI 통합 (3주차)

- [ ] Claude API 연동
- [ ] 프롬프트 시스템 구현
- [ ] 입력/출력 검증
- [ ] SSE 스트리밍

### Phase 6: 프론트엔드 (3-4주차)

- [ ] 인증 페이지
- [ ] Q&A 인터페이스
- [ ] 에디터 구현
- [ ] 대시보드

### Phase 7: 테스트 및 배포 (4주차)

- [ ] 단위 테스트
- [ ] 통합 테스트
- [ ] 보안 취약점 스캔
- [ ] 프로덕션 배포

---

## 8. 개발 시작하기

### 8.1 프로젝트 클론 및 설정

```bash
# 1. 프로젝트 클론
git clone https://github.com/your-org/magnetic-sales-webapp.git
cd magnetic-sales-webapp

# 2. 의존성 설치
npm install

# 3. 환경 변수 설정
cp .env.example .env.local
# .env.local 파일을 편집하여 실제 값 입력

# 4. Supabase 마이그레이션 실행
npx supabase db push

# 5. 개발 서버 시작
npm run dev
```

### 8.2 유용한 명령어

```bash
# 개발 서버
npm run dev

# 타입 체크
npm run type-check

# 린트
npm run lint

# 테스트
npm run test

# 빌드
npm run build

# Supabase 로컬 시작
npx supabase start

# 마이그레이션 생성
npx supabase migration new <migration_name>

# 마이그레이션 적용
npx supabase db push
```

---

## 부록 A: package.json 예시

```json
{
  "name": "magnetic-sales-webapp",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit",
    "test": "jest",
    "test:e2e": "playwright test"
  },
  "dependencies": {
    "next": "14.1.0",
    "react": "18.2.0",
    "react-dom": "18.2.0",
    "@supabase/supabase-js": "2.39.0",
    "@supabase/ssr": "0.1.0",
    "zustand": "4.5.0",
    "zod": "3.22.4",
    "@tiptap/react": "2.1.13",
    "@tiptap/starter-kit": "2.1.13",
    "dompurify": "3.0.8",
    "lucide-react": "0.309.0",
    "clsx": "2.1.0",
    "tailwind-merge": "2.2.0"
  },
  "devDependencies": {
    "typescript": "5.3.3",
    "@types/node": "20.10.6",
    "@types/react": "18.2.46",
    "@types/react-dom": "18.2.18",
    "@types/dompurify": "3.0.5",
    "tailwindcss": "3.4.1",
    "postcss": "8.4.33",
    "autoprefixer": "10.4.16",
    "eslint": "8.56.0",
    "eslint-config-next": "14.1.0",
    "jest": "29.7.0",
    "@testing-library/react": "14.1.2",
    "playwright": "1.41.0",
    "supabase": "1.133.3"
  }
}
```

---

## 부록 B: next.config.js 예시

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  // 보안 헤더
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'X-DNS-Prefetch-Control',
            value: 'on',
          },
          {
            key: 'Strict-Transport-Security',
            value: 'max-age=63072000; includeSubDomains; preload',
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          {
            key: 'X-XSS-Protection',
            value: '1; mode=block',
          },
          {
            key: 'Referrer-Policy',
            value: 'strict-origin-when-cross-origin',
          },
          {
            key: 'Content-Security-Policy',
            value: [
              "default-src 'self'",
              "script-src 'self' 'unsafe-eval' 'unsafe-inline'",
              "style-src 'self' 'unsafe-inline'",
              "img-src 'self' data: https:",
              "font-src 'self'",
              "connect-src 'self' https://*.supabase.co https://api.anthropic.com",
              "frame-ancestors 'none'",
            ].join('; '),
          },
        ],
      },
    ];
  },

  // 이미지 도메인
  images: {
    domains: ['your-project.supabase.co'],
  },

  // 실험적 기능
  experimental: {
    serverActions: true,
  },
};

module.exports = nextConfig;
```

---

**다음 문서**: [01_인증_시스템.md](./01_인증_시스템.md)
